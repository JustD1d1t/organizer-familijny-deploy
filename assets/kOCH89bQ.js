import{L as se,M as ue,r,o as re,N as i,O as de,t as u,A as l,z as s,P as t,B as v,Q as m,v as _,R as P,S,x as N,T as ie,U as ce,V as me,W as pe,X as ve,Y as _e,Z as be,$ as ye,a0 as fe,a1 as we,a2 as ge,y as Ie,a3 as ke,a4 as he,a5 as Ve,a6 as xe}from"./flSHHRYz.js";import{_ as Pe}from"./Das2RahG.js";import{u as Se}from"./B6-AGleL.js";const Ce={key:0,class:"inner-content"},Me={class:"modal-content"},ze={__name:"index",setup(De){const{photos:b,photoFromCamera:B,selectPhotoFromData:z}=Se(),C=se(),{removeExpenseFromStore:T,editExpense:U,getExpensePhoto:F}=C,{currentExpense:e}=ue(C),{billCategories:$}=ke(),{openAlert:A}=he(),M=de(),d=localStorage.getItem("uid");r("");const g=r(!1),I=r(null),k=r(null),L=r(!1),h=r(e.value.shop),V=r(e.value.name),x=r(e.value.value),y=r(e.value.timestamp),p=r(e.value.familyMembers),R=()=>{let a;e.value.timestamp.seconds?a=new Date(e.value.timestamp.seconds*1e3):a=new Date(e.value.timestamp);const o=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),f=String(a.getDate()).padStart(2,"0");y.value=`${o}-${c}-${f}`},Z=()=>{g.value=!1},j=async()=>{try{const{pb64:a,doc:o}=await B();k.value=a,I.value=o,L.value=!0}catch(a){console.error("Error adding photo",a)}},O=async()=>{try{const{pb64:a,doc:o}=await z();k.value=a,I.value=o}catch(a){console.error("Error selecting photo",a)}},W=async()=>{const a={name:V.value,value:Number(x.value),timestamp:new Date(y.value).getTime(),shop:h.value,familyMembers:p.value,userId:e.value.userId,id:e.value.id,category:e.value.category};await U(a,I.value,k.value),M.back()},Y=async()=>{await T(e.value.id),M.back()},G=async()=>{const a=await F(e.value.id);a&&b.value.push({webviewPath:a,document:{title:"New Photo",description:"Photo taken with the app",timestamp:new Date}})},H=async()=>{g.value=!0};re(async()=>{await G(),R()});const K=a=>{p.value.includes(a.id)?p.value=p.value.filter(o=>o!=a.id):p.value.push(a.id)};return(a,o)=>{const c=ie,f=ce,Q=me,X=pe,w=ve,q=Ve,J=_e,D=be,ee=Pe,te=ye,E=xe,oe=fe,ae=we,ne=ge;return u(),i(ne,null,{default:l(()=>[s(X,{style:{background:"var(--ion-color-light)"}},{default:l(()=>[s(Q,null,{default:l(()=>[t(e)&&t(e).userId===t(d)?(u(),i(f,{key:0,slot:"start"},{default:l(()=>[s(c,{fill:"clear",strong:!0,onClick:o[0]||(o[0]=()=>t(A)("Usuwanie wydatku","Czy na pewno chcesz usunąć wydatek?","alert-button-confirm",Y))},{default:l(()=>[v("Usuń")]),_:1})]),_:1})):m("",!0),t(e)&&t(e).userId===t(d)?(u(),i(f,{key:1,slot:"end"},{default:l(()=>[s(c,{fill:"clear",strong:!0,onClick:o[1]||(o[1]=n=>W())},{default:l(()=>[v("Zapisz")]),_:1})]),_:1})):m("",!0)]),_:1})]),_:1}),s(ae,{fullscreen:!0},{default:l(()=>[t(e)?(u(),_("div",Ce,[s(te,{lines:"none"},{default:l(()=>[s(w,{label:"Nazwa sklepu",type:"text",modelValue:h.value,"onUpdate:modelValue":o[2]||(o[2]=n=>h.value=n),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"]),s(w,{label:"Nazwa wydatku",type:"text",modelValue:V.value,"onUpdate:modelValue":o[3]||(o[3]=n=>V.value=n),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"]),s(w,{label:"Całkowita kwota",type:"number",modelValue:x.value,"onUpdate:modelValue":o[4]||(o[4]=n=>x.value=n),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"]),s(w,{label:"Data",type:"date",modelValue:y.value,"onUpdate:modelValue":o[5]||(o[5]=n=>y.value=n),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"]),s(D,null,{default:l(()=>[s(J,{label:"Kategoria",modelValue:t(e).category,"onUpdate:modelValue":o[6]||(o[6]=n=>t(e).category=n)},{default:l(()=>[(u(!0),_(P,null,S(t($),(n,le)=>(u(),i(q,{key:le,value:n},{default:l(()=>[v(Ie(n),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e).userId===t(d)?(u(),i(ee,{key:0,members:t(e).familyMembers,onToggleMember:K},null,8,["members"])):m("",!0)]),_:1}),t(e).userId===t(d)?(u(),i(D,{key:0},{default:l(()=>[s(c,{onClick:j},{default:l(()=>[v("Zrób zdjęcie")]),_:1}),s(c,{onClick:O,class:"ml-auto"},{default:l(()=>[v("Wybierz zdjęcie")]),_:1})]),_:1})):m("",!0),t(b).length?(u(),_("div",{key:1,onClick:H},[(u(!0),_(P,null,S(t(b),n=>(u(),i(E,{key:n.webviewPath,src:n.webviewPath},null,8,["src"]))),128))])):m("",!0),s(oe,{class:"auto-height modal-img","is-open":g.value,onDidDismiss:o[7]||(o[7]=n=>Z())},{default:l(()=>[N("div",Me,[N("div",null,[(u(!0),_(P,null,S(t(b),n=>(u(),i(E,{key:n.webviewPath,src:n.webviewPath},null,8,["src"]))),128))])])]),_:1},8,["is-open"])])):m("",!0)]),_:1})]),_:1})}}};export{ze as default};
