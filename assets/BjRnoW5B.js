import{_ as Ve,L as ye,N as be,M as ke,u as xe,r,O as E,A as l,a6 as Ne,t as v,z as a,B as m,x as R,Q as o,ac as I,v as S,T,S as F,R as he,a4 as Ie,V as Le,W as Ce,X as Ee,Y as Se,Z as Pe,$ as De,ak as Me,a0 as Ue,a3 as ze,a5 as Re,a2 as Te,y as B,a8 as Fe,aa as Be}from"./BeL7Np4Z.js";import{_ as Oe}from"./0ODLm9tx.js";import{_ as je}from"./DXiswl5s.js";import{T as Ae,u as Ke}from"./D7uZvskA.js";import{u as $e}from"./DvPt3fJ_.js";const We={class:"inner-content"},Ze={key:0,class:"w-full mt-8 flex justify-center items-center h-full"},Ge={__name:"index",setup(He){const{popularStores:Y}=Ke();$e();const q=ye(),{addExpenseToStore:J}=q,ee=be(),{uid:ae}=ke(ee),{billCategories:P}=Fe(),le=xe(),L=r(""),C=r(""),g=r(""),w=r(""),f=r(""),O=r([]);r(null),r(null),r(!1);const j=r(!1),D=r(!1),c=r({newShopName:"",newExpenseName:"",newExpenseValue:"",newExpenseDate:""}),b=r(null),A=r(!1),K=r(!1),p=r({name:"",price:"",category:""}),$=r(null),W=r([]),V=r(null);let x=null,N=null,k=0;const te=async s=>{j.value=!1,D.value=!0,$.value=null,x=null,N=null,k=0,f.value="",g.value="",w.value="";const e=s.target.files[0];if(!e)return;const n=new Image,u=new FileReader;u.onload=i=>{n.src=i.target.result},n.onload=()=>ne(n),u.readAsDataURL(e)},ne=s=>{const e=V.value.getContext("2d");V.value.width=s.width,V.value.height=s.height,e.drawImage(s,0,0),oe(e),se()},oe=s=>{const e=s.getImageData(0,0,V.value.width,V.value.height),n=e.data;for(let u=0;u<n.length;u+=4){const i=(n[u]+n[u+1]+n[u+2])/3;n[u]=n[u+1]=n[u+2]=i}s.putImageData(e,0,0)},se=()=>{V.value.toBlob(s=>{Ae.recognize(s,"pol").then(({data:{text:e}})=>{$.value=e,re(e)}).catch(e=>console.error("OCR processing error:",e))})},ue=s=>{for(let e of Y){const n=e.length*.5,u=e.toLowerCase(),i=s.toLowerCase();if(i.includes(u)&&u.split("").filter(d=>i.includes(d)).length>=n)return e}return null},re=s=>{s.split(`
`).forEach(n=>{if(!f.value){const _=ue(n);f.value=_}const u=n.match(/\d{1,4},\d{2}/),i=n.match(/SUMA\sPLN/),y=n.match(/RAZEM\sPLN/),d=n.match(/\d{4}\s*-\s*\d{2}\s*-\s*\d{2}/);if(i&&Z(i,"sumaPLN"),y&&Z(y,"razemPLN"),d&&(w.value=d[0].replaceAll(" ","")),u){const _=parseFloat(u[0].replace(",","."));_>k&&(k=_)}}),g.value=de(),j.value=!0,D.value=!1},Z=(s,e)=>{const n=s.input.match(/\d{1,4},\d{2}/);if(n){const u=parseFloat(n[0].replace(",","."));e==="sumaPLN"&&(x=u),e==="razemPLN"&&(N=u)}},de=()=>x&&x===k?x:N&&N===k?N:k,ie=()=>{c.value.shopName="",c.value.newExpenseValue="",c.value.newExpenseDate="",c.value.selectedCategory="",f.value||(c.value.shopName="Nazwa sklepu jest wymagana"),g.value||(c.value.newExpenseValue="Kwota jest wymagana"),w.value||(c.value.newExpenseDate="Data jest wymagana")},ce=async()=>{if(ie(),Object.values(c.value).some(e=>e))return;const s={name:C.value.toLowerCase(),value:parseFloat(g.value),timestamp:new Date(w.value).getTime(),shop:f.value.toLowerCase(),userId:ae.value,familyMembers:O.value,items:W.value,category:L.value};await J(s),le.back()},pe=s=>{O.value=s},G=s=>A.value=s,me=s=>K.value=s,fe=()=>{W.value.push({name:p.value.name,price:parseFloat(p.value.price),category:p.value.category}),me(!1),p.value={name:"",price:"",category:""}};return(s,e)=>{const n=Ie,u=Le,i=Ce,y=Ee,d=Se,_=Be,M=Pe,U=De,_e=Oe,ve=Me,ge=Ue,H=ze,Q=je,z=Re,X=Te,we=Ne;return v(),E(we,null,{default:l(()=>[a(y,{style:{background:"var(--ion-color-light)"}},{default:l(()=>[a(i,null,{default:l(()=>[a(u,{slot:"end"},{default:l(()=>[a(n,{strong:!0,onClick:e[0]||(e[0]=t=>ce())},{default:l(()=>[m("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(z,null,{default:l(()=>[R("div",We,[a(ge,{lines:"none"},{default:l(()=>[a(d,{type:"file",onChange:te}),a(d,{label:"Nazwa sklepu",modelValue:o(f),"onUpdate:modelValue":e[1]||(e[1]=t=>I(f)?f.value=t:null),error:o(c).shopName},null,8,["modelValue","error"]),a(d,{label:"Nawa wydatku",modelValue:o(C),"onUpdate:modelValue":e[2]||(e[2]=t=>I(C)?C.value=t:null)},null,8,["modelValue"]),a(d,{label:"Całkowita kwota",type:"number",error:o(c).newExpenseValue,modelValue:o(g),"onUpdate:modelValue":e[3]||(e[3]=t=>I(g)?g.value=t:null)},null,8,["error","modelValue"]),a(d,{label:"Data",type:"date",error:o(c).newExpenseDate,modelValue:o(w),"onUpdate:modelValue":e[4]||(e[4]=t=>I(w)?w.value=t:null)},null,8,["error","modelValue"]),a(U,null,{default:l(()=>[a(M,{label:"Kategoria","label-placement":"stacked",modelValue:o(L),"onUpdate:modelValue":e[5]||(e[5]=t=>I(L)?L.value=t:null)},{default:l(()=>[(v(!0),S(F,null,T(o(P),(t,h)=>(v(),E(_,{key:h,value:t},{default:l(()=>[m(B(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(_e,{onToggleMember:pe}),R("div",null,[R("canvas",{ref_key:"canvas",ref:V,style:{display:"none"}},null,512),o(D)?(v(),S("div",Ze,[a(ve,{name:"lines-sharp"})])):he("",!0)])]),_:1})]),a(X,{"is-open":o(A)},{default:l(()=>[a(y,null,{default:l(()=>[a(i,null,{default:l(()=>[a(H,null,{default:l(()=>[m("Edytuj produkt")]),_:1}),a(u,{slot:"end"},{default:l(()=>[a(n,{onClick:e[6]||(e[6]=t=>G(!1))},{default:l(()=>[m("Close")]),_:1})]),_:1})]),_:1})]),_:1}),a(z,{class:"ion-padding"},{default:l(()=>[a(Q,null,{default:l(()=>[a(d,{modelValue:o(b).name,"onUpdate:modelValue":e[7]||(e[7]=t=>o(b).name=t),label:"Nazwa produktu"},null,8,["modelValue"]),a(d,{modelValue:o(b).price,"onUpdate:modelValue":e[8]||(e[8]=t=>o(b).price=t),label:"Cena produktu"},null,8,["modelValue"]),a(U,null,{default:l(()=>[a(M,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:o(b).category,"onUpdate:modelValue":e[9]||(e[9]=t=>o(b).category=t)},{default:l(()=>[(v(!0),S(F,null,T(o(P),(t,h)=>(v(),E(_,{key:h,value:t},{default:l(()=>[m(B(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]),a(X,{"is-open":o(K)},{default:l(()=>[a(y,null,{default:l(()=>[a(i,null,{default:l(()=>[a(u,{slot:"start"},{default:l(()=>[a(n,{onClick:e[10]||(e[10]=t=>G(!1))},{default:l(()=>[m("anuluj")]),_:1})]),_:1}),a(H,null,{default:l(()=>[m("Nowy produkt")]),_:1}),a(u,{slot:"end"},{default:l(()=>[a(n,{onClick:fe},{default:l(()=>[m("Zapisz")]),_:1})]),_:1})]),_:1})]),_:1}),a(z,{class:"ion-padding"},{default:l(()=>[a(Q,null,{default:l(()=>[a(d,{modelValue:o(p).name,"onUpdate:modelValue":e[11]||(e[11]=t=>o(p).name=t),label:"Nazwa produktu"},null,8,["modelValue"]),a(d,{modelValue:o(p).price,"onUpdate:modelValue":e[12]||(e[12]=t=>o(p).price=t),label:"Cena produktu"},null,8,["modelValue"]),a(U,null,{default:l(()=>[a(M,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:o(p).category,"onUpdate:modelValue":e[13]||(e[13]=t=>o(p).category=t)},{default:l(()=>[(v(!0),S(F,null,T(o(P),(t,h)=>(v(),E(_,{key:h,value:t},{default:l(()=>[m(B(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1})}}},ea=Ve(Ge,[["__scopeId","data-v-3c112e2e"]]);export{ea as default};
