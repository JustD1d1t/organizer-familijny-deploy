import{_ as Re,M as Ue,ac as Be,L as Fe,u as Ae,r,i as le,N as E,A as s,Z as Oe,t as m,z as o,B as w,x as R,O as u,a2 as D,v as S,Q as A,R as O,P as X,ah as je,U as Te,V as Ke,W as Ze,a4 as $e,a6 as We,a1 as Ge,ao as Xe,a5 as Ye,X as qe,ag as He,S as Qe,Y as Je,a7 as et,y as Y,a9 as tt,C as at,D as ot,a3 as nt,ai as lt,aa as st}from"./C1Km0ovS.js";import{_ as ut}from"./BZ_2as7S.js";import{_ as rt}from"./CgTDa_rK.js";import{_ as ct}from"./OC_iv7tp.js";import{T as dt,u as it}from"./D7uZvskA.js";import{u as pt}from"./oj6a8h26.js";const mt=U=>(at("data-v-235da6a1"),U=U(),ot(),U),ft={class:"inner-content"},_t={key:0,class:"w-full mt-8 flex justify-center items-center h-full"},vt={key:1},gt=mt(()=>R("h2",null,"Rozpoznane produkty:",-1)),wt={__name:"index-full-read",setup(U){const{popularStores:se}=it(),{shoppingItemsCategories:ue}=pt(),re=Ue(),{addExpenseToStore:ce}=re,de=Be(),{uid:ie}=Fe(de),{billCategories:j}=nt(),{openDecideModal:pe}=lt(),me=Ae(),T=r(""),B=r(""),h=r(""),b=r(""),V=r(""),q=r([]);r(null),r(null);const K=r(!1),Z=r(!1),_=r({newShopName:"",newExpenseName:"",newExpenseValue:"",newExpenseDate:""}),I=r(null),H=r(!1),Q=r(!1),J=le(()=>{const t={};for(const[e,n]of Object.entries(ue))n.forEach(a=>{t[a]=e});return t}),fe=r(!1),v=r({name:"",price:"",category:""}),F=r(null),y=r([]);r(0);const N=r(null);r(null);const _e=le(()=>y.value.reduce((t,e)=>t+e.price,0));let P=null,M=null,x=0;const ve=async t=>{K.value=!1,Z.value=!0,F.value=null,P=null,M=null,x=0,V.value="",h.value="",b.value="";const e=t.target.files[0];if(!e)return;const n=new Image,a=new FileReader;a.onload=c=>{n.src=c.target.result},n.onload=()=>ge(n),a.readAsDataURL(e)},ge=t=>{const e=N.value.getContext("2d");N.value.width=t.width,N.value.height=t.height,e.drawImage(t,0,0),we(e),ye()},we=t=>{const e=t.getImageData(0,0,N.value.width,N.value.height),n=e.data;for(let a=0;a<n.length;a+=4){const c=(n[a]+n[a+1]+n[a+2])/3;n[a]=n[a+1]=n[a+2]=c}t.putImageData(e,0,0)},ye=()=>{N.value.toBlob(t=>{dt.recognize(t,"pol").then(({data:{text:e}})=>{F.value=e,be(e)}).catch(e=>console.error("OCR processing error:",e))})},ke=t=>{for(let e of se){const n=e.length*.5,a=e.toLowerCase(),c=t.toLowerCase();if(c.includes(a)&&a.split("").filter(d=>c.includes(d)).length>=n)return e}return null},he={O:["0"],0:["O"],I:["1","l"],1:["I","l"],l:["I","1"],o:["0"],i:["1","l"],5:["S"],S:["5"],2:["Z"],Z:["2"],8:["B"],B:["8"],7:["T"],T:["7"],E:["F"],F:["E"],G:["6"],6:["G"],C:["G","("],D:["O"],P:["R"],R:["P"],Q:["O"],Y:["V"],V:["Y"],X:["K"],K:["X"],W:["V"],V:["W"],N:["M"],M:["N"],U:["V"],V:["U"],a:["q","o"],q:["a","o"],s:["5"],z:["2"],b:["8"],g:["6"],h:["n"],n:["h"],"(":["C"]},ee=t=>he[t]||[],Ve=(t,e)=>{if(t===e)return!0;const n=ee(t),a=ee(e);return n.includes(e)||a.includes(t)},Ce=t=>{const e=t.toLowerCase();let n;const a=c=>{for(let k in J.value){const d=k.toLowerCase();for(let p=0;p<=d.length-c;p++){const g=d.slice(p,p+c);let f=!1;if(e.includes(g))f=!0;else for(let i=0;i<g.length;i++){const z=g[i],L=e.slice(p,p+c);if(L[i]&&Ve(z,L[i]))f=!0;else{f=!1;break}}if(f)return J.value[k]}}return""};return n=a(7),n||(n=a(6),n)||(n=a(5),n)||(n=a(4),n)?n:""},be=t=>{const e=t.split(`
`),n=[];e.forEach(a=>{if(a.match(/gotówka/i))return;if(!V.value){const i=ke(a);V.value=i}const c=a.match(/\d{1,4},\d{2}[ABC\(48\%]/),k=a.match(/-\d{1,4},\d{2}\s*-\s*\d{1,4},\d{2}/),d=a.match(/\d{1,4},\d{2}/),p=a.match(/SUMA\sPLN/),g=a.match(/RAZEM\sPLN/),f=a.match(/\d{4}\s*-\s*\d{2}\s*-\s*\d{2}/);if(console.log(a,k),p&&te(p,"sumaPLN"),g&&te(g,"razemPLN"),f&&(b.value=f[0].replaceAll(" ","")),d){const i=parseFloat(d[0].replace(",","."));i>x&&(x=i)}if(c){const i=a.match(/^[^a-zA-ZąśćółęźżĄŚĆÓŁĘŹŻ]*(?:[a-zA-ZąśćółęźżĄŚĆÓŁĘŹŻ.,\s]{2,})/),z=c[0].replace(/[ABC]/,"").replace(",",".");if(i){const L=Ce(i[0].trim());n.push({name:i[0].trim(),price:z?parseFloat(z).toFixed(2):null,category:L})}}}),h.value=Ie(),y.value=n,_e.value!==h.value&&(pe("Błąd w kwocie","Kwota wydatku nie zgadza się z sumą produktów na paragonie. Proszę sprawdzić dane. Chcesz sprawdzić poszczególne produkty czy dodać paragon jedynie z całkowitą kwotą?",()=>{F.value=null,y.value=[]},()=>{},"Zapisz kwotę","Sprawdź produkty"),fe.value=!0),K.value=!0,Z.value=!1},te=(t,e)=>{const n=t.input.match(/\d{1,4},\d{2}/);if(n){const a=parseFloat(n[0].replace(",","."));e==="sumaPLN"&&(P=a),e==="razemPLN"&&(M=a)}},Ie=()=>P&&P===x?P:M&&M===x?M:x,Ne=()=>{_.value.shopName="",_.value.newExpenseValue="",_.value.newExpenseDate="",V.value||(_.value.shopName="Nazwa sklepu jest wymagana"),h.value||(_.value.newExpenseValue="Kwota jest wymagana"),b.value||(_.value.newExpenseDate="Data jest wymagana")},xe=async()=>{if(Ne(),Object.values(_.value).some(e=>e))return;const t={name:B.value.toLowerCase(),value:parseFloat(h.value),timestamp:new Date(b.value).getTime(),shop:V.value.toLowerCase(),userId:ie.value,familyMembers:q.value,items:y.value};await ce(t),me.back()},ze=t=>{q.value=t},$=t=>H.value=t,ae=t=>Q.value=t,Le=t=>{I.value=t,$(!0)},Ee=()=>{y.value.push({name:v.value.name,price:parseFloat(v.value.price),category:v.value.category}),ae(!1),v.value={name:"",price:"",category:""}};return(t,e)=>{const n=je,a=Te,c=Ke,k=Ze,d=$e,p=st,g=We,f=Ge,i=ut,z=Xe,L=rt,W=ct,Se=Ye,Pe=qe,Me=He,oe=Qe,G=Je,ne=et,De=Oe;return m(),E(De,null,{default:s(()=>[o(k,{style:{background:"var(--ion-color-light)"}},{default:s(()=>[o(c,null,{default:s(()=>[o(a,{slot:"end"},{default:s(()=>[o(n,{strong:!0,onClick:e[0]||(e[0]=l=>xe())},{default:s(()=>[w("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),o(G,null,{default:s(()=>[R("div",ft,[o(Me,{lines:"none"},{default:s(()=>[o(d,{label:"Nazwa sklepu",modelValue:u(V),"onUpdate:modelValue":e[1]||(e[1]=l=>D(V)?V.value=l:null),error:u(_).shopName},null,8,["modelValue","error"]),o(d,{label:"Nawa wydatku",modelValue:u(B),"onUpdate:modelValue":e[2]||(e[2]=l=>D(B)?B.value=l:null)},null,8,["modelValue"]),o(d,{label:"Całkowita kwota",type:"number",error:u(_).newExpenseValue,modelValue:u(h),"onUpdate:modelValue":e[3]||(e[3]=l=>D(h)?h.value=l:null)},null,8,["error","modelValue"]),o(d,{label:"Data",type:"date",error:u(_).newExpenseDate,modelValue:u(b),"onUpdate:modelValue":e[4]||(e[4]=l=>D(b)?b.value=l:null)},null,8,["error","modelValue"]),!u(y).length&&u(K)?(m(),E(f,{key:0},{default:s(()=>[o(g,{label:"Kategoria","label-placement":"stacked",modelValue:u(T),"onUpdate:modelValue":e[5]||(e[5]=l=>D(T)?T.value=l:null)},{default:s(()=>[(m(!0),S(O,null,A(u(j),(l,C)=>(m(),E(p,{key:C,value:l},{default:s(()=>[w(Y(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):X("",!0),o(i,{onToggleMember:ze}),R("div",null,[R("input",{type:"file",onChange:ve},null,32),R("canvas",{ref_key:"canvas",ref:N,style:{display:"none"}},null,512),u(Z)?(m(),S("div",_t,[o(z,{name:"lines-sharp"})])):X("",!0),u(F)&&u(y).length?(m(),S("div",vt,[gt,o(W,null,{default:s(()=>[(m(!0),S(O,null,A(u(y),(l,C)=>(m(),E(L,{key:C,name:l.name,price:l.price,category:l.category,onButtonClick:()=>Le(l),onRemoveClick:()=>u(y).splice(C,1)},null,8,["name","price","category","onButtonClick","onRemoveClick"]))),128))]),_:1}),o(Pe,{type:"tertiary",class:"w-full",onClick:e[6]||(e[6]=l=>ae(!0))},{default:s(()=>[o(Se,{slot:"icon-only",icon:"ioniconsAdd"in t?t.ioniconsAdd:u(tt)},null,8,["icon"]),w(" Dodaj produkt ")]),_:1})])):X("",!0)])]),_:1})]),o(ne,{"is-open":u(H)},{default:s(()=>[o(k,null,{default:s(()=>[o(c,null,{default:s(()=>[o(oe,null,{default:s(()=>[w("Edytuj produkt")]),_:1}),o(a,{slot:"end"},{default:s(()=>[o(n,{onClick:e[7]||(e[7]=l=>$(!1))},{default:s(()=>[w("Close")]),_:1})]),_:1})]),_:1})]),_:1}),o(G,{class:"ion-padding"},{default:s(()=>[o(W,null,{default:s(()=>[o(d,{modelValue:u(I).name,"onUpdate:modelValue":e[8]||(e[8]=l=>u(I).name=l),label:"Nazwa produktu"},null,8,["modelValue"]),o(d,{modelValue:u(I).price,"onUpdate:modelValue":e[9]||(e[9]=l=>u(I).price=l),label:"Cena produktu"},null,8,["modelValue"]),o(f,null,{default:s(()=>[o(g,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:u(I).category,"onUpdate:modelValue":e[10]||(e[10]=l=>u(I).category=l)},{default:s(()=>[(m(!0),S(O,null,A(u(j),(l,C)=>(m(),E(p,{key:C,value:l},{default:s(()=>[w(Y(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]),o(ne,{"is-open":u(Q)},{default:s(()=>[o(k,null,{default:s(()=>[o(c,null,{default:s(()=>[o(a,{slot:"start"},{default:s(()=>[o(n,{onClick:e[11]||(e[11]=l=>$(!1))},{default:s(()=>[w("anuluj")]),_:1})]),_:1}),o(oe,null,{default:s(()=>[w("Nowy produkt")]),_:1}),o(a,{slot:"end"},{default:s(()=>[o(n,{onClick:Ee},{default:s(()=>[w("Zapisz")]),_:1})]),_:1})]),_:1})]),_:1}),o(G,{class:"ion-padding"},{default:s(()=>[o(W,null,{default:s(()=>[o(d,{modelValue:u(v).name,"onUpdate:modelValue":e[12]||(e[12]=l=>u(v).name=l),label:"Nazwa produktu"},null,8,["modelValue"]),o(d,{modelValue:u(v).price,"onUpdate:modelValue":e[13]||(e[13]=l=>u(v).price=l),label:"Cena produktu"},null,8,["modelValue"]),o(f,null,{default:s(()=>[o(g,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:u(v).category,"onUpdate:modelValue":e[14]||(e[14]=l=>u(v).category=l)},{default:s(()=>[(m(!0),S(O,null,A(u(j),(l,C)=>(m(),E(p,{key:C,value:l},{default:s(()=>[w(Y(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1})}}},It=Re(wt,[["__scopeId","data-v-235da6a1"]]);export{It as default};
