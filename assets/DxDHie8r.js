import{an as W,ao as G,M,r as x,t as c,v as A,z as a,A as o,B,P as i,ai as fe,x as N,ab as pe,U as ge,V as J,W as K,ap as ye,Z as Ie,aq as he,$ as X,ar as be,as as ve,at as we,au as ke,L as Me,i as Se,N as f,a2 as ze,Q as p,S as Ce,R as Fe,l as $e,a7 as Ee,aa as Le,a0 as Te,ag as De,av as Ae,ah as Be,a1 as Ne,y as H,T as Pe}from"./WOMjux0z.js";import{_ as Ve}from"./DJDHHIBL.js";import{t as Q,e as Ue,d as Re,p as Ze}from"./CHVAF33P.js";const je={class:"ion-padding inner-content"},Oe=N("h3",null,"Dodaj członka rodziny",-1),qe={__name:"edit-modal",emits:"cancel",setup(Y,{emit:P}){const V=W(),{sendNotification:g}=V,{backendUrl:S}=be(),{request:U}=ve(),z=G(),{updateMembers:R,createFamily:y}=z,{familyMembersDetails:d}=M(z),C=P,u=x(""),F=x(),I=localStorage.getItem("uid"),Z=async _=>{const s=[...d.value,{..._,status:"pending"}];return await R(s),s},$=async _=>{const s=[{email:localStorage.getItem("email"),id:localStorage.getItem("uid"),uid:localStorage.getItem("uid"),nickname:localStorage.getItem("nickname"),status:"accepted"},{..._,status:"pending"}];return await y(s),s},E=async()=>{const s=(await U(`${S}/users/get-users?email=${u.value.toLowerCase()}`)).users;if(!s.length)return;const r=s[0];let l;d.value.length?l=await Z(r):l=await $(r),await g({title:`Zaproszenie do rodziny użytkownika "${localStorage.getItem("email")}"`,content:`Zostałeś zaproszony do rodziny przez użytkownika "${localStorage.getItem("email")}"`,type:"invitation-to-family",ownerId:I},r.uid),C("confirmModal",l)},h=()=>{C("cancel")};return(_,s)=>{const r=pe,l=ge,j=J,L=K,m=ye,T=Ie,O=he,q=X;return c(),A("div",je,[a(L,{style:{background:"var(--ion-color-light)"}},{default:o(()=>[a(j,null,{default:o(()=>[a(l,{fill:"clear",slot:"start"},{default:o(()=>[a(r,{onClick:s[0]||(s[0]=v=>h())},{default:o(()=>[B("Anuluj")]),_:1})]),_:1}),a(l,{slot:"end"},{default:o(()=>[a(r,{strong:!0,onClick:s[1]||(s[1]=v=>E())},{default:o(()=>[B("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(q,{lines:"none"},{default:o(()=>[a(T,null,{default:o(()=>[a(m,null,{default:o(()=>[Oe]),_:1})]),_:1}),a(T,null,{default:o(()=>[a(O,{"data-test":"shop-input",label:"Mail","label-placement":"floating",ref_key:"emailInput",ref:F,class:"shopInput",type:"text",modelValue:i(u),"onUpdate:modelValue":s[2]||(s[2]=v=>fe(u)?u.value=v:null)},null,8,["modelValue"])]),_:1})]),_:1})])}}},xe=N("h2",null,"Członkowie rodziny",-1),He={key:0},Qe={key:0},Ke={__name:"index",setup(Y){const P=W(),{sendNotification:V}=P,g=localStorage.getItem("uid"),S=G(),{updateMembers:U,removeFamily:z,leaveFamily:R}=S,{familyMembers:y,familyMembersDetails:d,familyId:C}=M(S),u=x(),F=we(),{shoppingLists:I}=M(F),{getAllShoppingLists:Z,updateShoppingList:$}=F,E=ke(),{pantries:h}=M(E),{getAllPantries:_,editPantry:s}=E,r=Me(),{expenses:l}=M(r),{getAllMyExpenses:j,editExpense:L}=r,m=Se(()=>C.value===g),T=()=>u.value.$el.dismiss(null,"cancel"),O=()=>u.value.$el.dismiss(null,"confirm"),q=n=>{O(),d.value=n,m.value=!0},v=async n=>{I.value.length?I.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await $(e))}):(await Z(),I.value.length&&I.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await $(e))}))},ee=async n=>{h.value.length?h.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await s(e))}):(await _(),h.value.length&&h.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await s(e))}))},ne=async n=>{l.value.length?l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(t=>t!==n.id),L(e))}):(await j(),l.value.length&&l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(t=>t!==n.id),L(e))}))},te=async n=>{const e=d.value.filter(w=>w.id!==n.id),t=y.value.filter(w=>w!==n.id);await U(e,t),await v(n),await ee(n),await ne(n),await V({title:`Zostałeś usunięty z rodziny "${localStorage.getItem("email")}"`,content:`Zostałeś usunięty z rodziny przez użytkownika "${localStorage.getItem("email")}`},n.id)},oe=async()=>{const n=d.value.filter(t=>t.id!==g),e=y.value.filter(t=>t!==g);await R(n,e),$e("/")};return(n,e)=>{const t=Ee,w=J,ae=K,k=Le,se=Pe,ie=Ve,le=X,ce=qe,re=Te,D=De,de=Ae,ue=Be,me=Ne,_e=ze;return c(),f(_e,null,{default:o(()=>[a(ae,{style:{background:"var(--ion-color-light)"}},{default:o(()=>[a(w,null,{default:o(()=>[a(t,null,{default:o(()=>[B("Rodzina")]),_:1})]),_:1})]),_:1}),a(me,{fullscreen:!0},{default:o(()=>[N("div",null,[xe,i(d).length?p("",!0):(c(),A("h3",He," Nie należysz do żadnej rodziny ")),a(le,{lines:"none"},{default:o(()=>[(c(!0),A(Fe,null,Ce(i(d),b=>(c(),f(ie,{key:b.id,class:"flex items-center"},{start:o(()=>[N("span",null,[B(H(b.nickname)+" ("+H(b.email)+") ",1),b.status==="pending"?(c(),A("small",Qe,"(oczekiwanie)")):p("",!0)])]),end:o(()=>[i(m)&&b.id!==i(g)?(c(),f(se,{key:0,type:"tertiary",onClick:()=>te(b),size:"small"},{default:o(()=>[a(k,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024))),128))]),_:1})]),i(m)||!i(y).length?(c(),f(re,{key:0,class:"auto-height",ref_key:"modal",ref:u,trigger:"open-modal"},{default:o(()=>[a(ce,{onCancel:T,onConfirmModal:q})]),_:1},512)):p("",!0),a(ue,{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:o(()=>[a(D,null,{default:o(()=>[a(k,{icon:"ioniconsArrowUpCircle"in n?n.ioniconsArrowUpCircle:i(Ue)},null,8,["icon"])]),_:1}),a(de,{side:"top"},{default:o(()=>[i(m)||!i(y).length?(c(),f(D,{key:0,id:"open-modal"},{default:o(()=>[a(k,{icon:"ioniconsAdd"in n?n.ioniconsAdd:i(Re)},null,8,["icon"])]),_:1})):p("",!0),i(m)?p("",!0):(c(),f(D,{key:1,onClick:oe},{default:o(()=>[a(k,{icon:"ioniconsPlayForwardCircleOutline"in n?n.ioniconsPlayForwardCircleOutline:i(Ze)},null,8,["icon"])]),_:1})),i(m)?(c(),f(D,{key:2,onClick:i(z)},{default:o(()=>[a(k,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ke as default};
