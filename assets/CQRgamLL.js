import{aw as W,ax as X,M as y,N as J,r as K,t as c,v as B,z as a,A as t,B as N,Q as i,ar as ve,x as U,a4 as he,V as be,W as Y,X as ee,ay as we,$ as ge,az as Ie,a0 as ne,aA as ke,aB as Me,aC as ze,aD as Ce,L as Se,i as Fe,O as f,a6 as $e,R as p,T as Ee,S as Le,l as De,a3 as Te,a1 as Ae,a2 as Be,al as Ne,aE as Ue,am as Ve,a5 as Pe,y as G,aF as Q,aG as Oe,a7 as Re,aH as je,U as xe}from"./CtmnvVoy.js";import{_ as Ze}from"./DXx0u4sX.js";const qe={class:"ion-padding inner-content"},He=U("h3",null,"Dodaj członka rodziny",-1),Ge={__name:"edit-modal",emits:"cancel",setup(oe,{emit:V}){const P=W(),{sendNotification:O}=P,{backendUrl:v}=ke(),{request:F}=Me(),I=X(),{updateMembers:R,createFamily:j}=I,{familyMembersDetails:$}=y(I),h=J(),{uid:r,email:u,nickname:k}=y(h),M=V,b=K(),x=async _=>{const s=[...$.value,{..._,status:"pending"}];return await R(s),s},E=async _=>{const s=[{email:u.value,id:r.value,uid:r.value,nickname:k.value,status:"accepted"},{..._,status:"pending"}];return await j(s),s},L=async()=>{const s=(await F(`${v}/users/get-users?email=${u.value.toLowerCase()}`)).users;if(!s.length)return;const d=s[0];let l;$.value.length?l=await x(d):l=await E(d),await O({title:`Zaproszenie do rodziny użytkownika "${u.value}"`,content:`Zostałeś zaproszony do rodziny przez użytkownika "${u.value}"`,type:"invitation-to-family",ownerId:r.value},d.uid),M("confirmModal",l)},w=()=>{M("cancel")};return(_,s)=>{const d=he,l=be,Z=Y,D=ee,m=we,T=ge,q=Ie,H=ne;return c(),B("div",qe,[a(D,{style:{background:"var(--ion-color-light)"}},{default:t(()=>[a(Z,null,{default:t(()=>[a(l,{slot:"start"},{default:t(()=>[a(d,{onClick:s[0]||(s[0]=z=>w())},{default:t(()=>[N("Anuluj")]),_:1})]),_:1}),a(l,{slot:"end"},{default:t(()=>[a(d,{strong:!0,onClick:s[1]||(s[1]=z=>L())},{default:t(()=>[N("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(H,{lines:"none"},{default:t(()=>[a(T,null,{default:t(()=>[a(m,null,{default:t(()=>[He]),_:1})]),_:1}),a(T,null,{default:t(()=>[a(q,{"data-test":"shop-input",label:"Mail","label-placement":"floating",ref_key:"emailInput",ref:b,class:"shopInput",type:"text",modelValue:i(u),"onUpdate:modelValue":s[2]||(s[2]=z=>ve(u)?u.value=z:null)},null,8,["modelValue"])]),_:1})]),_:1})])}}},Qe=U("h2",null,"Członkowie rodziny",-1),We={key:0},Xe={key:0},Ye={__name:"index",setup(oe){const V=W(),{sendNotification:P}=V,O=J(),{uid:v,email:F}=y(O),I=X(),{updateMembers:R,removeFamily:j,leaveFamily:$}=I,{familyMembers:h,familyMembersDetails:r,familyId:u}=y(I),k=K(),M=ze(),{shoppingLists:b}=y(M),{getAllShoppingLists:x,updateShoppingList:E}=M,L=Ce(),{pantries:w}=y(L),{getAllPantries:_,editPantry:s}=L,d=Se(),{expenses:l}=y(d),{getAllMyExpenses:Z,editExpense:D}=d,m=Fe(()=>u.value===v.value),T=()=>k.value.$el.dismiss(null,"cancel"),q=()=>k.value.$el.dismiss(null,"confirm"),H=n=>{q(),r.value=n,m.value=!0},z=async n=>{b.value.length?b.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await E(e))}):(await x(),b.value.length&&b.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await E(e))}))},te=async n=>{w.value.length?w.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await s(e))}):(await _(),w.value.length&&w.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await s(e))}))},ae=async n=>{l.value.length?l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(o=>o!==n.id),D(e))}):(await Z(),l.value.length&&l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(o=>o!==n.id),D(e))}))},se=async n=>{const e=r.value.filter(C=>C.id!==n.id),o=h.value.filter(C=>C!==n.id);await R(e,o),await z(n),await te(n),await ae(n),await P({title:`Zostałeś usunięty z rodziny "${F.value}"`,content:`Zostałeś usunięty z rodziny przez użytkownika "${F.value}`},n.id)},ie=async()=>{const n=r.value.filter(o=>o.id!==v.value),e=h.value.filter(o=>o!==v.value);await $(n,e),De("/")};return(n,e)=>{const o=Te,C=Y,le=ee,S=Ae,ce=xe,re=Ze,ue=ne,de=Ge,me=Be,A=Ne,_e=Ue,fe=Ve,pe=Pe,ye=$e;return c(),f(ye,null,{default:t(()=>[a(le,{style:{background:"var(--ion-color-light)"}},{default:t(()=>[a(C,null,{default:t(()=>[a(o,null,{default:t(()=>[N("Rodzina")]),_:1})]),_:1})]),_:1}),a(pe,{fullscreen:!0},{default:t(()=>[U("div",null,[Qe,i(r).length?p("",!0):(c(),B("h3",We," Nie należysz do żadnej rodziny ")),a(ue,{lines:"none"},{default:t(()=>[(c(!0),B(Le,null,Ee(i(r),g=>(c(),f(re,{key:g.id,class:"flex items-center"},{start:t(()=>[U("span",null,[N(G(g.nickname)+" ("+G(g.email)+") ",1),g.status==="pending"?(c(),B("small",Xe,"(oczekiwanie)")):p("",!0)])]),end:t(()=>[i(m)&&g.id!==i(v)?(c(),f(ce,{key:0,type:"tertiary",onClick:()=>se(g),size:"small"},{default:t(()=>[a(S,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024))),128))]),_:1})]),i(m)||!i(h).length?(c(),f(me,{key:0,class:"auto-height",ref_key:"modal",ref:k,trigger:"open-modal"},{default:t(()=>[a(de,{onCancel:T,onConfirmModal:H})]),_:1},512)):p("",!0),a(fe,{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:t(()=>[a(A,null,{default:t(()=>[a(S,{icon:"ioniconsArrowUpCircle"in n?n.ioniconsArrowUpCircle:i(Oe)},null,8,["icon"])]),_:1}),a(_e,{side:"top"},{default:t(()=>[i(m)||!i(h).length?(c(),f(A,{key:0,id:"open-modal"},{default:t(()=>[a(S,{icon:"ioniconsAdd"in n?n.ioniconsAdd:i(Re)},null,8,["icon"])]),_:1})):p("",!0),i(m)?p("",!0):(c(),f(A,{key:1,onClick:ie},{default:t(()=>[a(S,{icon:"ioniconsPlayForwardCircleOutline"in n?n.ioniconsPlayForwardCircleOutline:i(je)},null,8,["icon"])]),_:1})),i(m)?(c(),f(A,{key:2,onClick:i(j)},{default:t(()=>[a(S,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ye as default};
