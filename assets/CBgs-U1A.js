import{at as W,au as G,M,r as q,t as c,v as A,z as a,A as o,B,P as i,ao as fe,x as N,a3 as pe,U as ye,V as J,W as K,av as ge,Z as Ie,aw as he,$ as X,ax as ve,ay as be,az as we,aA as ke,L as Me,i as Se,N as f,a5 as ze,Q as p,S as Ce,R as Fe,l as $e,a2 as Ee,a0 as Le,a1 as De,al as Te,aB as Ae,am as Be,a4 as Ne,y as H,aC as Q,aD as Pe,a6 as Ve,aE as Ue,T as Re}from"./BClyMcC6.js";import{_ as Ze}from"./DA2MfVHI.js";const je={class:"ion-padding inner-content"},xe=N("h3",null,"Dodaj członka rodziny",-1),Oe={__name:"edit-modal",emits:"cancel",setup(Y,{emit:P}){const V=W(),{sendNotification:y}=V,{backendUrl:S}=ve(),{request:U}=be(),z=G(),{updateMembers:R,createFamily:g}=z,{familyMembersDetails:d}=M(z),C=P,u=q(""),F=q(),I=localStorage.getItem("uid"),Z=async _=>{const s=[...d.value,{..._,status:"pending"}];return await R(s),s},$=async _=>{const s=[{email:localStorage.getItem("email"),id:localStorage.getItem("uid"),uid:localStorage.getItem("uid"),nickname:localStorage.getItem("nickname"),status:"accepted"},{..._,status:"pending"}];return await g(s),s},E=async()=>{const s=(await U(`${S}/users/get-users?email=${u.value.toLowerCase()}`)).users;if(!s.length)return;const r=s[0];let l;d.value.length?l=await Z(r):l=await $(r),await y({title:`Zaproszenie do rodziny użytkownika "${localStorage.getItem("email")}"`,content:`Zostałeś zaproszony do rodziny przez użytkownika "${localStorage.getItem("email")}"`,type:"invitation-to-family",ownerId:I},r.uid),C("confirmModal",l)},h=()=>{C("cancel")};return(_,s)=>{const r=pe,l=ye,j=J,L=K,m=ge,D=Ie,x=he,O=X;return c(),A("div",je,[a(L,{style:{background:"var(--ion-color-light)"}},{default:o(()=>[a(j,null,{default:o(()=>[a(l,{slot:"start"},{default:o(()=>[a(r,{onClick:s[0]||(s[0]=b=>h())},{default:o(()=>[B("Anuluj")]),_:1})]),_:1}),a(l,{slot:"end"},{default:o(()=>[a(r,{strong:!0,onClick:s[1]||(s[1]=b=>E())},{default:o(()=>[B("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(O,{lines:"none"},{default:o(()=>[a(D,null,{default:o(()=>[a(m,null,{default:o(()=>[xe]),_:1})]),_:1}),a(D,null,{default:o(()=>[a(x,{"data-test":"shop-input",label:"Mail","label-placement":"floating",ref_key:"emailInput",ref:F,class:"shopInput",type:"text",modelValue:i(u),"onUpdate:modelValue":s[2]||(s[2]=b=>fe(u)?u.value=b:null)},null,8,["modelValue"])]),_:1})]),_:1})])}}},qe=N("h2",null,"Członkowie rodziny",-1),He={key:0},Qe={key:0},Je={__name:"index",setup(Y){const P=W(),{sendNotification:V}=P,y=localStorage.getItem("uid"),S=G(),{updateMembers:U,removeFamily:z,leaveFamily:R}=S,{familyMembers:g,familyMembersDetails:d,familyId:C}=M(S),u=q(),F=we(),{shoppingLists:I}=M(F),{getAllShoppingLists:Z,updateShoppingList:$}=F,E=ke(),{pantries:h}=M(E),{getAllPantries:_,editPantry:s}=E,r=Me(),{expenses:l}=M(r),{getAllMyExpenses:j,editExpense:L}=r,m=Se(()=>C.value===y),D=()=>u.value.$el.dismiss(null,"cancel"),x=()=>u.value.$el.dismiss(null,"confirm"),O=n=>{x(),d.value=n,m.value=!0},b=async n=>{I.value.length?I.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await $(e))}):(await Z(),I.value.length&&I.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await $(e))}))},ee=async n=>{h.value.length?h.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await s(e))}):(await _(),h.value.length&&h.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await s(e))}))},ne=async n=>{l.value.length?l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(t=>t!==n.id),L(e))}):(await j(),l.value.length&&l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(t=>t!==n.id),L(e))}))},te=async n=>{const e=d.value.filter(w=>w.id!==n.id),t=g.value.filter(w=>w!==n.id);await U(e,t),await b(n),await ee(n),await ne(n),await V({title:`Zostałeś usunięty z rodziny "${localStorage.getItem("email")}"`,content:`Zostałeś usunięty z rodziny przez użytkownika "${localStorage.getItem("email")}`},n.id)},oe=async()=>{const n=d.value.filter(t=>t.id!==y),e=g.value.filter(t=>t!==y);await R(n,e),$e("/")};return(n,e)=>{const t=Ee,w=J,ae=K,k=Le,se=Re,ie=Ze,le=X,ce=Oe,re=De,T=Te,de=Ae,ue=Be,me=Ne,_e=ze;return c(),f(_e,null,{default:o(()=>[a(ae,{style:{background:"var(--ion-color-light)"}},{default:o(()=>[a(w,null,{default:o(()=>[a(t,null,{default:o(()=>[B("Rodzina")]),_:1})]),_:1})]),_:1}),a(me,{fullscreen:!0},{default:o(()=>[N("div",null,[qe,i(d).length?p("",!0):(c(),A("h3",He," Nie należysz do żadnej rodziny ")),a(le,{lines:"none"},{default:o(()=>[(c(!0),A(Fe,null,Ce(i(d),v=>(c(),f(ie,{key:v.id,class:"flex items-center"},{start:o(()=>[N("span",null,[B(H(v.nickname)+" ("+H(v.email)+") ",1),v.status==="pending"?(c(),A("small",Qe,"(oczekiwanie)")):p("",!0)])]),end:o(()=>[i(m)&&v.id!==i(y)?(c(),f(se,{key:0,type:"tertiary",onClick:()=>te(v),size:"small"},{default:o(()=>[a(k,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024))),128))]),_:1})]),i(m)||!i(g).length?(c(),f(re,{key:0,class:"auto-height",ref_key:"modal",ref:u,trigger:"open-modal"},{default:o(()=>[a(ce,{onCancel:D,onConfirmModal:O})]),_:1},512)):p("",!0),a(ue,{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:o(()=>[a(T,null,{default:o(()=>[a(k,{icon:"ioniconsArrowUpCircle"in n?n.ioniconsArrowUpCircle:i(Pe)},null,8,["icon"])]),_:1}),a(de,{side:"top"},{default:o(()=>[i(m)||!i(g).length?(c(),f(T,{key:0,id:"open-modal"},{default:o(()=>[a(k,{icon:"ioniconsAdd"in n?n.ioniconsAdd:i(Ve)},null,8,["icon"])]),_:1})):p("",!0),i(m)?p("",!0):(c(),f(T,{key:1,onClick:oe},{default:o(()=>[a(k,{icon:"ioniconsPlayForwardCircleOutline"in n?n.ioniconsPlayForwardCircleOutline:i(Ue)},null,8,["icon"])]),_:1})),i(m)?(c(),f(T,{key:2,onClick:i(z)},{default:o(()=>[a(k,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Je as default};
