import{_ as De,L as Be,u as Fe,r,i as le,N as E,A as s,a5 as Re,t as m,z as o,B as w,x as F,P as u,aq as B,v as S,S as O,R as j,Q as X,a3 as Ue,U as Ae,V as Oe,W as je,X as Te,Y as Ke,Z as Ze,ak as $e,a0 as We,T as Ge,$ as qe,a2 as Xe,a4 as Ye,a1 as He,y as Y,a6 as Qe,C as Je,D as et,a7 as tt,a8 as at,a9 as ot}from"./DRa_VBAG.js";import{_ as nt}from"./b_PMGHYX.js";import{_ as lt}from"./BgxoZcP-.js";import{_ as st}from"./B0difAmE.js";import{T as ut,u as rt}from"./D7uZvskA.js";import{u as ct}from"./oj6a8h26.js";const dt=R=>(Je("data-v-623182a3"),R=R(),et(),R),it={class:"inner-content"},pt={key:0,class:"w-full mt-8 flex justify-center items-center h-full"},mt={key:1},ft=dt(()=>F("h2",null,"Rozpoznane produkty:",-1)),_t={__name:"index-full-read",setup(R){const{popularStores:se}=rt(),{shoppingItemsCategories:ue}=ct(),re=Be(),{addExpenseToStore:ce}=re,de=localStorage.getItem("uid"),{billCategories:T}=tt(),{openDecideModal:ie}=at(),pe=Fe(),K=r(""),U=r(""),h=r(""),b=r(""),V=r(""),P=r([]);r(null),r(null);const Z=r(!1),$=r(!1),_=r({newShopName:"",newExpenseName:"",newExpenseValue:"",newExpenseDate:""}),I=r(null),H=r(!1),Q=r(!1),J=le(()=>{const t={};for(const[e,n]of Object.entries(ue))n.forEach(a=>{t[a]=e});return t}),me=r(!1),v=r({name:"",price:"",category:""}),A=r(null),y=r([]);r(0);const N=r(null);r(null);const fe=le(()=>y.value.reduce((t,e)=>t+e.price,0));let M=null,D=null,x=0;const _e=async t=>{Z.value=!1,$.value=!0,A.value=null,M=null,D=null,x=0,V.value="",h.value="",b.value="";const e=t.target.files[0];if(!e)return;const n=new Image,a=new FileReader;a.onload=c=>{n.src=c.target.result},n.onload=()=>ve(n),a.readAsDataURL(e)},ve=t=>{const e=N.value.getContext("2d");N.value.width=t.width,N.value.height=t.height,e.drawImage(t,0,0),ge(e),we()},ge=t=>{const e=t.getImageData(0,0,N.value.width,N.value.height),n=e.data;for(let a=0;a<n.length;a+=4){const c=(n[a]+n[a+1]+n[a+2])/3;n[a]=n[a+1]=n[a+2]=c}t.putImageData(e,0,0)},we=()=>{N.value.toBlob(t=>{ut.recognize(t,"pol").then(({data:{text:e}})=>{A.value=e,Ce(e)}).catch(e=>console.error("OCR processing error:",e))})},ye=t=>{for(let e of se){const n=e.length*.5,a=e.toLowerCase(),c=t.toLowerCase();if(c.includes(a)&&a.split("").filter(d=>c.includes(d)).length>=n)return e}return null},ke={O:["0"],0:["O"],I:["1","l"],1:["I","l"],l:["I","1"],o:["0"],i:["1","l"],5:["S"],S:["5"],2:["Z"],Z:["2"],8:["B"],B:["8"],7:["T"],T:["7"],E:["F"],F:["E"],G:["6"],6:["G"],C:["G","("],D:["O"],P:["R"],R:["P"],Q:["O"],Y:["V"],V:["Y"],X:["K"],K:["X"],W:["V"],V:["W"],N:["M"],M:["N"],U:["V"],V:["U"],a:["q","o"],q:["a","o"],s:["5"],z:["2"],b:["8"],g:["6"],h:["n"],n:["h"],"(":["C"]},ee=t=>ke[t]||[],he=(t,e)=>{if(t===e)return!0;const n=ee(t),a=ee(e);return n.includes(e)||a.includes(t)},Ve=t=>{const e=t.toLowerCase();let n;const a=c=>{for(let k in J.value){const d=k.toLowerCase();for(let p=0;p<=d.length-c;p++){const g=d.slice(p,p+c);let f=!1;if(e.includes(g))f=!0;else for(let i=0;i<g.length;i++){const z=g[i],L=e.slice(p,p+c);if(L[i]&&he(z,L[i]))f=!0;else{f=!1;break}}if(f)return J.value[k]}}return""};return n=a(7),n||(n=a(6),n)||(n=a(5),n)||(n=a(4),n)?n:""},Ce=t=>{const e=t.split(`
`),n=[];e.forEach(a=>{if(a.match(/gotówka/i))return;if(!V.value){const i=ye(a);V.value=i}const c=a.match(/\d{1,4},\d{2}[ABC\(48\%]/),k=a.match(/-\d{1,4},\d{2}\s*-\s*\d{1,4},\d{2}/),d=a.match(/\d{1,4},\d{2}/),p=a.match(/SUMA\sPLN/),g=a.match(/RAZEM\sPLN/),f=a.match(/\d{4}\s*-\s*\d{2}\s*-\s*\d{2}/);if(console.log(a,k),p&&te(p,"sumaPLN"),g&&te(g,"razemPLN"),f&&(b.value=f[0].replaceAll(" ","")),d){const i=parseFloat(d[0].replace(",","."));i>x&&(x=i)}if(c){const i=a.match(/^[^a-zA-ZąśćółęźżĄŚĆÓŁĘŹŻ]*(?:[a-zA-ZąśćółęźżĄŚĆÓŁĘŹŻ.,\s]{2,})/),z=c[0].replace(/[ABC]/,"").replace(",",".");if(i){const L=Ve(i[0].trim());n.push({name:i[0].trim(),price:z?parseFloat(z).toFixed(2):null,category:L})}}}),h.value=be(),y.value=n,fe.value!==h.value&&(ie("Błąd w kwocie","Kwota wydatku nie zgadza się z sumą produktów na paragonie. Proszę sprawdzić dane. Chcesz sprawdzić poszczególne produkty czy dodać paragon jedynie z całkowitą kwotą?",()=>{A.value=null,y.value=[]},()=>{},"Zapisz kwotę","Sprawdź produkty"),me.value=!0),Z.value=!0,$.value=!1},te=(t,e)=>{const n=t.input.match(/\d{1,4},\d{2}/);if(n){const a=parseFloat(n[0].replace(",","."));e==="sumaPLN"&&(M=a),e==="razemPLN"&&(D=a)}},be=()=>M&&M===x?M:D&&D===x?D:x,Ie=()=>{_.value.shopName="",_.value.newExpenseValue="",_.value.newExpenseDate="",V.value||(_.value.shopName="Nazwa sklepu jest wymagana"),h.value||(_.value.newExpenseValue="Kwota jest wymagana"),b.value||(_.value.newExpenseDate="Data jest wymagana")},Ne=async()=>{if(Ie(),Object.values(_.value).some(e=>e))return;const t={name:U.value.toLowerCase(),value:parseFloat(h.value),timestamp:new Date(b.value).getTime(),shop:V.value.toLowerCase(),userId:de,familyMembers:P.value,items:y.value};await ce(t),pe.back()},xe=t=>{P.value.includes(t.id)?P.value=P.value.filter(e=>e!=t.id):P.value.push(t.id)},W=t=>H.value=t,ae=t=>Q.value=t,ze=t=>{I.value=t,W(!0)},Le=()=>{y.value.push({name:v.value.name,price:parseFloat(v.value.price),category:v.value.category}),ae(!1),v.value={name:"",price:"",category:""}};return(t,e)=>{const n=Ue,a=Ae,c=Oe,k=je,d=Te,p=ot,g=Ke,f=Ze,i=nt,z=$e,L=lt,G=st,Ee=We,Se=Ge,Pe=qe,oe=Xe,q=Ye,ne=He,Me=Re;return m(),E(Me,null,{default:s(()=>[o(k,{style:{background:"var(--ion-color-light)"}},{default:s(()=>[o(c,null,{default:s(()=>[o(a,{slot:"end"},{default:s(()=>[o(n,{strong:!0,onClick:e[0]||(e[0]=l=>Ne())},{default:s(()=>[w("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),o(q,null,{default:s(()=>[F("div",it,[o(Pe,{lines:"none"},{default:s(()=>[o(d,{label:"Nazwa sklepu",modelValue:u(V),"onUpdate:modelValue":e[1]||(e[1]=l=>B(V)?V.value=l:null),error:u(_).shopName},null,8,["modelValue","error"]),o(d,{label:"Nawa wydatku",modelValue:u(U),"onUpdate:modelValue":e[2]||(e[2]=l=>B(U)?U.value=l:null)},null,8,["modelValue"]),o(d,{label:"Całkowita kwota",type:"number",error:u(_).newExpenseValue,modelValue:u(h),"onUpdate:modelValue":e[3]||(e[3]=l=>B(h)?h.value=l:null)},null,8,["error","modelValue"]),o(d,{label:"Data",type:"date",error:u(_).newExpenseDate,modelValue:u(b),"onUpdate:modelValue":e[4]||(e[4]=l=>B(b)?b.value=l:null)},null,8,["error","modelValue"]),!u(y).length&&u(Z)?(m(),E(f,{key:0},{default:s(()=>[o(g,{label:"Kategoria","label-placement":"stacked",modelValue:u(K),"onUpdate:modelValue":e[5]||(e[5]=l=>B(K)?K.value=l:null)},{default:s(()=>[(m(!0),S(j,null,O(u(T),(l,C)=>(m(),E(p,{key:C,value:l},{default:s(()=>[w(Y(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):X("",!0),o(i,{onToggleMember:xe}),F("div",null,[F("input",{type:"file",onChange:_e},null,32),F("canvas",{ref_key:"canvas",ref:N,style:{display:"none"}},null,512),u($)?(m(),S("div",pt,[o(z,{name:"lines-sharp"})])):X("",!0),u(A)&&u(y).length?(m(),S("div",mt,[ft,o(G,null,{default:s(()=>[(m(!0),S(j,null,O(u(y),(l,C)=>(m(),E(L,{key:C,name:l.name,price:l.price,category:l.category,onButtonClick:()=>ze(l),onRemoveClick:()=>u(y).splice(C,1)},null,8,["name","price","category","onButtonClick","onRemoveClick"]))),128))]),_:1}),o(Se,{type:"tertiary",class:"w-full",onClick:e[6]||(e[6]=l=>ae(!0))},{default:s(()=>[o(Ee,{slot:"icon-only",icon:"ioniconsAdd"in t?t.ioniconsAdd:u(Qe)},null,8,["icon"]),w(" Dodaj produkt ")]),_:1})])):X("",!0)])]),_:1})]),o(ne,{"is-open":u(H)},{default:s(()=>[o(k,null,{default:s(()=>[o(c,null,{default:s(()=>[o(oe,null,{default:s(()=>[w("Edytuj produkt")]),_:1}),o(a,{slot:"end"},{default:s(()=>[o(n,{onClick:e[7]||(e[7]=l=>W(!1))},{default:s(()=>[w("Close")]),_:1})]),_:1})]),_:1})]),_:1}),o(q,{class:"ion-padding"},{default:s(()=>[o(G,null,{default:s(()=>[o(d,{modelValue:u(I).name,"onUpdate:modelValue":e[8]||(e[8]=l=>u(I).name=l),label:"Nazwa produktu"},null,8,["modelValue"]),o(d,{modelValue:u(I).price,"onUpdate:modelValue":e[9]||(e[9]=l=>u(I).price=l),label:"Cena produktu"},null,8,["modelValue"]),o(f,null,{default:s(()=>[o(g,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:u(I).category,"onUpdate:modelValue":e[10]||(e[10]=l=>u(I).category=l)},{default:s(()=>[(m(!0),S(j,null,O(u(T),(l,C)=>(m(),E(p,{key:C,value:l},{default:s(()=>[w(Y(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]),o(ne,{"is-open":u(Q)},{default:s(()=>[o(k,null,{default:s(()=>[o(c,null,{default:s(()=>[o(a,{slot:"start"},{default:s(()=>[o(n,{onClick:e[11]||(e[11]=l=>W(!1))},{default:s(()=>[w("anuluj")]),_:1})]),_:1}),o(oe,null,{default:s(()=>[w("Nowy produkt")]),_:1}),o(a,{slot:"end"},{default:s(()=>[o(n,{onClick:Le},{default:s(()=>[w("Zapisz")]),_:1})]),_:1})]),_:1})]),_:1}),o(q,{class:"ion-padding"},{default:s(()=>[o(G,null,{default:s(()=>[o(d,{modelValue:u(v).name,"onUpdate:modelValue":e[12]||(e[12]=l=>u(v).name=l),label:"Nazwa produktu"},null,8,["modelValue"]),o(d,{modelValue:u(v).price,"onUpdate:modelValue":e[13]||(e[13]=l=>u(v).price=l),label:"Cena produktu"},null,8,["modelValue"]),o(f,null,{default:s(()=>[o(g,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:u(v).category,"onUpdate:modelValue":e[14]||(e[14]=l=>u(v).category=l)},{default:s(()=>[(m(!0),S(j,null,O(u(T),(l,C)=>(m(),E(p,{key:C,value:l},{default:s(()=>[w(Y(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1})}}},Vt=De(_t,[["__scopeId","data-v-623182a3"]]);export{Vt as default};
