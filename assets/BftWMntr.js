import{L as le,M as ne,r,o as se,N as i,O as ue,t as u,A as n,z as s,P as t,B as _,Q as p,v as f,R as S,S as M,x as B,T as re,U as de,V as ie,W as ce,X as me,Y as pe,Z as ve,$ as _e,a0 as fe,a1 as be,y as ye,a2 as ge,a3 as we,a4 as Ie}from"./4SDWm5CT.js";import{_ as ke}from"./BAiSJCV0.js";import{u as he}from"./DU-Eg9pg.js";const Ve={key:0,class:"inner-content"},xe={class:"modal-content"},De={__name:"index",setup(Pe){const{photos:b,photoFromCamera:N,selectPhotoFromData:T}=he(),C=le(),{removeExpenseFromStore:U,editExpense:z,getExpensePhoto:$}=C,{currentExpense:e}=ne(C),{billCategories:F}=ge(),D=ue(),d=localStorage.getItem("uid");r("");const I=r(!1),k=r(null),h=r(null),R=r(!1),V=r(e.value.shop),x=r(e.value.name),P=r(e.value.value),y=r(e.value.timestamp),v=r(e.value.familyMembers),Z=()=>{let o;e.value.timestamp.seconds?o=new Date(e.value.timestamp.seconds*1e3):o=new Date(e.value.timestamp);const a=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),g=String(o.getDate()).padStart(2,"0");y.value=`${a}-${c}-${g}`},j=()=>{I.value=!1},L=async()=>{try{const{pb64:o,doc:a}=await N();h.value=o,k.value=a,R.value=!0}catch(o){console.error("Error adding photo",o)}},O=async()=>{try{const{pb64:o,doc:a}=await T();h.value=o,k.value=a}catch(o){console.error("Error selecting photo",o)}},W=async()=>{const o={name:x.value,value:P.value,timestamp:new Date(y.value).getTime(),shop:V.value,familyMembers:v.value,userId:e.value.userId,id:e.value.id,category:e.value.category};await z(o,k.value,h.value),D.back()},Y=async()=>{await U(e.value.id),D.back()},A=async()=>{const o=await $(e.value.id);o&&b.value.push({webviewPath:o,document:{title:"New Photo",description:"Photo taken with the app",timestamp:new Date}})},G=async()=>{I.value=!0};se(async()=>{await A(),Z()});const H=o=>{v.value.includes(o.id)?v.value=v.value.filter(a=>a!=o.id):v.value.push(o.id)};return(o,a)=>{const c=re,g=de,K=ie,Q=ce,w=me,m=pe,X=we,q=ve,J=ke,E=Ie,ee=_e,te=fe,ae=be;return u(),i(ae,null,{default:n(()=>[s(Q,null,{default:n(()=>[s(K,null,{default:n(()=>[t(e)&&t(e).userId===t(d)?(u(),i(g,{key:0,slot:"start"},{default:n(()=>[s(c,{fill:"clear",strong:!0,onClick:a[0]||(a[0]=l=>Y())},{default:n(()=>[_("Usuń")]),_:1})]),_:1})):p("",!0),t(e)&&t(e).userId===t(d)?(u(),i(g,{key:1,slot:"end"},{default:n(()=>[s(c,{fill:"clear",strong:!0,onClick:a[1]||(a[1]=l=>W())},{default:n(()=>[_("Zapisz")]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1}),s(te,{fullscreen:!0},{default:n(()=>[t(e)?(u(),f("div",Ve,[s(m,null,{default:n(()=>[s(w,{"data-test":"shop-input",label:"Nazwa sklepu","label-placement":"floating",type:"text",modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=l=>V.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(w,{"data-test":"name-input",label:"Nazwa wydatku","label-placement":"floating",type:"text",modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=l=>x.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(w,{"data-test":"value-input",label:"Całkowita kwota","label-placement":"floating",type:"number",modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=l=>P.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(w,{"data-test":"date-input",label:"Data","label-placement":"floating",type:"date",modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=l=>y.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(q,{label:"Kategoria",modelValue:t(e).category,"onUpdate:modelValue":a[6]||(a[6]=l=>t(e).category=l)},{default:n(()=>[(u(!0),f(S,null,M(t(F),(l,oe)=>(u(),i(X,{key:oe,value:l},{default:n(()=>[_(ye(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e).userId===t(d)?(u(),i(J,{key:0,members:t(e).familyMembers,onToggleMember:H},null,8,["members"])):p("",!0),t(e).userId===t(d)?(u(),i(m,{key:1},{default:n(()=>[s(c,{onClick:L},{default:n(()=>[_("Zrób zdjęcie")]),_:1}),s(c,{onClick:O,class:"ml-auto"},{default:n(()=>[_("Wybierz zdjęcie")]),_:1})]),_:1})):p("",!0),t(b).length?(u(),f("div",{key:2,onClick:G},[(u(!0),f(S,null,M(t(b),l=>(u(),i(E,{key:l.webviewPath,src:l.webviewPath},null,8,["src"]))),128))])):p("",!0),s(ee,{class:"auto-height modal-img","is-open":I.value,onDidDismiss:a[7]||(a[7]=l=>j())},{default:n(()=>[B("div",xe,[B("div",null,[(u(!0),f(S,null,M(t(b),l=>(u(),i(E,{key:l.webviewPath,src:l.webviewPath},null,8,["src"]))),128))])])]),_:1},8,["is-open"])])):p("",!0)]),_:1})]),_:1})}}};export{De as default};
