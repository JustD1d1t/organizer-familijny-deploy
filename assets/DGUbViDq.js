import{aA as W,aB as X,L as y,ac as Y,r as J,t as c,v as B,z as a,A as t,B as T,O as i,a2 as ye,x as N,ah as ve,U as he,V as K,W as ee,aC as be,a1 as we,a4 as ge,ad as Me,ae as ke,aD as Ie,aE as ze,M as Ce,i as Se,N as f,Z as Fe,P as p,Q as $e,R as Ee,l as Le,S as De,a5 as Ae,ag as Be,a7 as Te,aq as Ne,aF as Pe,ar as Ue,Y as Ve,y as G,a8 as Q,aG as xe,a9 as Oe,aH as Re,X as Ze}from"./CJWsRK-Q.js";import{_ as je}from"./DDnUFzLS.js";import{_ as qe}from"./B8fMttEA.js";const He={class:"ion-padding inner-content"},Ge=N("h3",null,"Dodaj członka rodziny",-1),Qe={__name:"edit-modal",emits:"cancel",setup(ne,{emit:P}){const U=W(),{sendNotification:V}=U,{backendUrl:v}=Me(),{request:F}=ke(),g=X(),{updateMembers:x,createFamily:O}=g,{familyMembersDetails:$}=y(g),h=Y(),{uid:r,email:M,nickname:k}=y(h),I=P,u=J(""),R=async _=>{const s=[...$.value,{..._,status:"pending"}];return await x(s),s},E=async _=>{const s=[{email:M.value,id:r.value,uid:r.value,nickname:k.value,status:"accepted"},{..._,status:"pending"}];return await O(s),s},L=async()=>{const s=(await F(`${v}/users/get-users?email=${u.value.toLowerCase()}`)).users;if(!s.length)return;const d=s[0];let l;$.value.length?l=await R(d):l=await E(d),await V({title:`Zaproszenie do rodziny użytkownika "${M.value}"`,content:`Zostałeś zaproszony do rodziny przez użytkownika "${M.value}"`,type:"invitation-to-family",ownerId:r.value},d.uid),I("confirmModal",l)},b=()=>{I("cancel")};return(_,s)=>{const d=ve,l=he,Z=K,D=ee,m=be,j=we,q=ge,H=qe;return c(),B("div",He,[a(D,{style:{background:"var(--ion-color-light)"}},{default:t(()=>[a(Z,null,{default:t(()=>[a(l,{slot:"start"},{default:t(()=>[a(d,{onClick:s[0]||(s[0]=z=>b())},{default:t(()=>[T("Anuluj")]),_:1})]),_:1}),a(l,{slot:"end"},{default:t(()=>[a(d,{strong:!0,onClick:s[1]||(s[1]=z=>L())},{default:t(()=>[T("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(H,null,{default:t(()=>[a(j,null,{default:t(()=>[a(m,null,{default:t(()=>[Ge]),_:1})]),_:1}),a(q,{"data-test":"shop-input",label:"Mail",class:"shopInput",type:"text",modelValue:i(u),"onUpdate:modelValue":s[2]||(s[2]=z=>ye(u)?u.value=z:null)},null,8,["modelValue"])]),_:1})])}}},We=N("h2",null,"Członkowie rodziny",-1),Xe={key:0},Ye={key:0},nn={__name:"index",setup(ne){const P=W(),{sendNotification:U}=P,V=Y(),{uid:v,email:F}=y(V),g=X(),{updateMembers:x,removeFamily:O,leaveFamily:$}=g,{familyMembers:h,familyMembersDetails:r,familyId:M}=y(g),k=J(),I=Ie(),{shoppingLists:u}=y(I),{getAllShoppingLists:R,updateShoppingList:E}=I,L=ze(),{pantries:b}=y(L),{getAllPantries:_,editPantry:s}=L,d=Ce(),{expenses:l}=y(d),{getAllMyExpenses:Z,editExpense:D}=d,m=Se(()=>M.value===v.value),j=()=>k.value.$el.dismiss(null,"cancel"),q=()=>k.value.$el.dismiss(null,"confirm"),H=n=>{q(),r.value=n,m.value=!0},z=async n=>{u.value.length?u.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await E(e))}):(await R(),u.value.length&&u.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await E(e))}))},oe=async n=>{b.value.length?b.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await s(e))}):(await _(),b.value.length&&b.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await s(e))}))},te=async n=>{l.value.length?l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(o=>o!==n.id),D(e))}):(await Z(),l.value.length&&l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(o=>o!==n.id),D(e))}))},ae=async n=>{const e=r.value.filter(C=>C.id!==n.id),o=h.value.filter(C=>C!==n.id);await x(e,o),await z(n),await oe(n),await te(n),await U({title:`Zostałeś usunięty z rodziny "${F.value}"`,content:`Zostałeś usunięty z rodziny przez użytkownika "${F.value}`},n.id)},se=async()=>{const n=r.value.filter(o=>o.id!==v.value),e=h.value.filter(o=>o!==v.value);await $(n,e),Le("/")};return(n,e)=>{const o=De,C=K,ie=ee,S=Ae,le=Ze,ce=je,re=Be,ue=Qe,de=Te,A=Ne,me=Pe,_e=Ue,fe=Ve,pe=Fe;return c(),f(pe,null,{default:t(()=>[a(ie,{style:{background:"var(--ion-color-light)"}},{default:t(()=>[a(C,null,{default:t(()=>[a(o,null,{default:t(()=>[T("Rodzina")]),_:1})]),_:1})]),_:1}),a(fe,{fullscreen:!0},{default:t(()=>[N("div",null,[We,i(r).length?p("",!0):(c(),B("h3",Xe," Nie należysz do żadnej rodziny ")),a(re,{lines:"none"},{default:t(()=>[(c(!0),B(Ee,null,$e(i(r),w=>(c(),f(ce,{key:w.id,class:"flex items-center"},{start:t(()=>[N("span",null,[T(G(w.nickname)+" ("+G(w.email)+") ",1),w.status==="pending"?(c(),B("small",Ye,"(oczekiwanie)")):p("",!0)])]),end:t(()=>[i(m)&&w.id!==i(v)?(c(),f(le,{key:0,type:"tertiary",onClick:()=>ae(w),size:"small"},{default:t(()=>[a(S,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024))),128))]),_:1})]),i(m)||!i(h).length?(c(),f(de,{key:0,class:"auto-height",ref_key:"modal",ref:k,trigger:"open-modal"},{default:t(()=>[a(ue,{onCancel:j,onConfirmModal:H})]),_:1},512)):p("",!0),a(_e,{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:t(()=>[a(A,null,{default:t(()=>[a(S,{icon:"ioniconsArrowUpCircle"in n?n.ioniconsArrowUpCircle:i(xe)},null,8,["icon"])]),_:1}),a(me,{side:"top"},{default:t(()=>[i(m)||!i(h).length?(c(),f(A,{key:0,id:"open-modal"},{default:t(()=>[a(S,{icon:"ioniconsAdd"in n?n.ioniconsAdd:i(Oe)},null,8,["icon"])]),_:1})):p("",!0),i(m)?p("",!0):(c(),f(A,{key:1,onClick:se},{default:t(()=>[a(S,{icon:"ioniconsPlayForwardCircleOutline"in n?n.ioniconsPlayForwardCircleOutline:i(Re)},null,8,["icon"])]),_:1})),i(m)?(c(),f(A,{key:2,onClick:i(O)},{default:t(()=>[a(S,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{nn as default};
