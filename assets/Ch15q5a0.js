import{aA as W,aB as X,L as y,ac as Y,r as J,t as c,v as T,z as a,A as t,B as N,O as i,a2 as ve,x as P,ah as he,U as be,V as K,W as ee,aC as ge,a1 as we,aD as Ie,ag as ne,ad as ke,ae as Me,aE as ze,aF as Ce,M as Se,i as Fe,N as f,Z as $e,P as p,Q as Ee,R as Le,l as De,S as Ae,a5 as Be,a7 as Te,aq as Ne,aG as Pe,ar as Ue,Y as Ve,y as G,a8 as Q,aH as Oe,a9 as Re,aI as Ze,X as je}from"./BcoMjeDL.js";import{_ as qe}from"./DzuJMwEx.js";const xe={class:"ion-padding inner-content"},He=P("h3",null,"Dodaj członka rodziny",-1),Ge={__name:"edit-modal",emits:"cancel",setup(oe,{emit:U}){const V=W(),{sendNotification:O}=V,{backendUrl:v}=ke(),{request:F}=Me(),I=X(),{updateMembers:R,createFamily:Z}=I,{familyMembersDetails:$}=y(I),h=Y(),{uid:r,email:u,nickname:k}=y(h),M=U,b=J(),j=async _=>{const s=[...$.value,{..._,status:"pending"}];return await R(s),s},E=async _=>{const s=[{email:u.value,id:r.value,uid:r.value,nickname:k.value,status:"accepted"},{..._,status:"pending"}];return await Z(s),s},L=async()=>{const s=(await F(`${v}/users/get-users?email=${u.value.toLowerCase()}`)).users;if(!s.length)return;const d=s[0];let l;$.value.length?l=await j(d):l=await E(d),await O({title:`Zaproszenie do rodziny użytkownika "${u.value}"`,content:`Zostałeś zaproszony do rodziny przez użytkownika "${u.value}"`,type:"invitation-to-family",ownerId:r.value},d.uid),M("confirmModal",l)},g=()=>{M("cancel")};return(_,s)=>{const d=he,l=be,q=K,D=ee,m=ge,A=we,x=Ie,H=ne;return c(),T("div",xe,[a(D,{style:{background:"var(--ion-color-light)"}},{default:t(()=>[a(q,null,{default:t(()=>[a(l,{slot:"start"},{default:t(()=>[a(d,{onClick:s[0]||(s[0]=z=>g())},{default:t(()=>[N("Anuluj")]),_:1})]),_:1}),a(l,{slot:"end"},{default:t(()=>[a(d,{strong:!0,onClick:s[1]||(s[1]=z=>L())},{default:t(()=>[N("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(H,{lines:"none"},{default:t(()=>[a(A,null,{default:t(()=>[a(m,null,{default:t(()=>[He]),_:1})]),_:1}),a(A,null,{default:t(()=>[a(x,{"data-test":"shop-input",label:"Mail","label-placement":"floating",ref_key:"emailInput",ref:b,class:"shopInput",type:"text",modelValue:i(u),"onUpdate:modelValue":s[2]||(s[2]=z=>ve(u)?u.value=z:null)},null,8,["modelValue"])]),_:1})]),_:1})])}}},Qe=P("h2",null,"Członkowie rodziny",-1),We={key:0},Xe={key:0},Ke={__name:"index",setup(oe){const U=W(),{sendNotification:V}=U,O=Y(),{uid:v,email:F}=y(O),I=X(),{updateMembers:R,removeFamily:Z,leaveFamily:$}=I,{familyMembers:h,familyMembersDetails:r,familyId:u}=y(I),k=J(),M=ze(),{shoppingLists:b}=y(M),{getAllShoppingLists:j,updateShoppingList:E}=M,L=Ce(),{pantries:g}=y(L),{getAllPantries:_,editPantry:s}=L,d=Se(),{expenses:l}=y(d),{getAllMyExpenses:q,editExpense:D}=d,m=Fe(()=>u.value===v.value),A=()=>k.value.$el.dismiss(null,"cancel"),x=()=>k.value.$el.dismiss(null,"confirm"),H=n=>{x(),r.value=n,m.value=!0},z=async n=>{b.value.length?b.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await E(e))}):(await j(),b.value.length&&b.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await E(e))}))},te=async n=>{g.value.length?g.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await s(e))}):(await _(),g.value.length&&g.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(o=>o!==n.id),e.members=e.members.filter(o=>o.id!==n.id),await s(e))}))},ae=async n=>{l.value.length?l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(o=>o!==n.id),D(e))}):(await q(),l.value.length&&l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(o=>o!==n.id),D(e))}))},se=async n=>{const e=r.value.filter(C=>C.id!==n.id),o=h.value.filter(C=>C!==n.id);await R(e,o),await z(n),await te(n),await ae(n),await V({title:`Zostałeś usunięty z rodziny "${F.value}"`,content:`Zostałeś usunięty z rodziny przez użytkownika "${F.value}`},n.id)},ie=async()=>{const n=r.value.filter(o=>o.id!==v.value),e=h.value.filter(o=>o!==v.value);await $(n,e),De("/")};return(n,e)=>{const o=Ae,C=K,le=ee,S=Be,ce=je,re=qe,ue=ne,de=Ge,me=Te,B=Ne,_e=Pe,fe=Ue,pe=Ve,ye=$e;return c(),f(ye,null,{default:t(()=>[a(le,{style:{background:"var(--ion-color-light)"}},{default:t(()=>[a(C,null,{default:t(()=>[a(o,null,{default:t(()=>[N("Rodzina")]),_:1})]),_:1})]),_:1}),a(pe,{fullscreen:!0},{default:t(()=>[P("div",null,[Qe,i(r).length?p("",!0):(c(),T("h3",We," Nie należysz do żadnej rodziny ")),a(ue,{lines:"none"},{default:t(()=>[(c(!0),T(Le,null,Ee(i(r),w=>(c(),f(re,{key:w.id,class:"flex items-center"},{start:t(()=>[P("span",null,[N(G(w.nickname)+" ("+G(w.email)+") ",1),w.status==="pending"?(c(),T("small",Xe,"(oczekiwanie)")):p("",!0)])]),end:t(()=>[i(m)&&w.id!==i(v)?(c(),f(ce,{key:0,type:"tertiary",onClick:()=>se(w),size:"small"},{default:t(()=>[a(S,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024))),128))]),_:1})]),i(m)||!i(h).length?(c(),f(me,{key:0,class:"auto-height",ref_key:"modal",ref:k,trigger:"open-modal"},{default:t(()=>[a(de,{onCancel:A,onConfirmModal:H})]),_:1},512)):p("",!0),a(fe,{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:t(()=>[a(B,null,{default:t(()=>[a(S,{icon:"ioniconsArrowUpCircle"in n?n.ioniconsArrowUpCircle:i(Oe)},null,8,["icon"])]),_:1}),a(_e,{side:"top"},{default:t(()=>[i(m)||!i(h).length?(c(),f(B,{key:0,id:"open-modal"},{default:t(()=>[a(S,{icon:"ioniconsAdd"in n?n.ioniconsAdd:i(Re)},null,8,["icon"])]),_:1})):p("",!0),i(m)?p("",!0):(c(),f(B,{key:1,onClick:ie},{default:t(()=>[a(S,{icon:"ioniconsPlayForwardCircleOutline"in n?n.ioniconsPlayForwardCircleOutline:i(Ze)},null,8,["icon"])]),_:1})),i(m)?(c(),f(B,{key:2,onClick:i(Z)},{default:t(()=>[a(S,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ke as default};
