import{_ as se,M as re,ac as ue,L as ce,u as ie,r as o,o as de,N as P,A as i,Z as me,t as V,z as l,B as k,x as I,O as d,a2 as y,v as M,Q as pe,R as fe,P as _e,ah as ve,U as ge,V as he,W as we,a4 as xe,a6 as ye,a1 as Ne,ao as Le,ag as Ve,Y as be,y as Ie,a3 as Se,aa as Ee}from"./B0ZLNBRr.js";import{_ as Ce}from"./cp4E9YXQ.js";import{T as De,u as Pe}from"./D7uZvskA.js";import{u as ke}from"./B8xnmsti.js";const Me={class:"inner-content"},Re={key:0,class:"w-full mt-8 flex justify-center items-center h-full"},Fe={__name:"index",setup(Ue){const{popularStores:R}=Pe();ke();const F=re(),{addExpenseToStore:U}=F,B=ue(),{uid:T}=ce(B),{billCategories:z}=Se(),j=ie(),N=o(""),L=o(""),f=o(""),m=o(),p=o(""),S=o([]);o(null),o(null),o(!1);const E=o(!1),b=o(!1),r=o({newShopName:"",newExpenseName:"",newExpenseValue:"",newExpenseDate:""});o(null),o(!1),o(!1),o({name:"",price:"",category:""});const C=o(null),A=o([]),_=o(null);let h=null,w=null,v=0;const O=async a=>{E.value=!1,b.value=!0,C.value=null,h=null,w=null,v=0,p.value="",f.value="",m.value="";const e=a.target.files[0];if(!e)return;const t=new Image,n=new FileReader;n.onload=u=>{t.src=u.target.result},t.onload=()=>$(t),n.readAsDataURL(e)},$=a=>{const e=_.value.getContext("2d");_.value.width=a.width,_.value.height=a.height,e.drawImage(a,0,0),G(e),H()},G=a=>{const e=a.getImageData(0,0,_.value.width,_.value.height),t=e.data;for(let n=0;n<t.length;n+=4){const u=(t[n]+t[n+1]+t[n+2])/3;t[n]=t[n+1]=t[n+2]=u}a.putImageData(e,0,0)},H=()=>{_.value.toBlob(a=>{De.recognize(a,"pol").then(({data:{text:e}})=>{C.value=e,Y(e)}).catch(e=>console.error("OCR processing error:",e))})},K=a=>{for(let e of R){const t=e.length*.5,n=e.toLowerCase(),u=a.toLowerCase();if(u.includes(n)&&n.split("").filter(c=>u.includes(c)).length>=t)return e}return null},Y=a=>{a.split(`
`).forEach(t=>{if(!p.value){const g=K(t);p.value=g}const n=t.match(/\d{1,4},\d{2}/),u=t.match(/SUMA\sPLN/),x=t.match(/RAZEM\sPLN/),c=t.match(/\d{4}\s*-\s*\d{2}\s*-\s*\d{2}/);if(u&&D(u,"sumaPLN"),x&&D(x,"razemPLN"),c&&(m.value=c[0].replaceAll(" ","")),n){const g=parseFloat(n[0].replace(",","."));g>v&&(v=g)}}),f.value=Z(),E.value=!0,b.value=!1},D=(a,e)=>{const t=a.input.match(/\d{1,4},\d{2}/);if(t){const n=parseFloat(t[0].replace(",","."));e==="sumaPLN"&&(h=n),e==="razemPLN"&&(w=n)}},Z=()=>h&&h===v?h:w&&w===v?w:v,Q=()=>{r.value.shopName="",r.value.newExpenseValue="",r.value.newExpenseDate="",r.value.selectedCategory="",p.value||(r.value.shopName="Nazwa sklepu jest wymagana"),f.value||(r.value.newExpenseValue="Kwota jest wymagana"),m.value||(r.value.newExpenseDate="Data jest wymagana")},W=async()=>{if(Q(),Object.values(r.value).some(e=>e))return;const a={name:L.value.toLowerCase(),value:parseFloat(f.value),timestamp:new Date(m.value).getTime(),shop:p.value.toLowerCase(),userId:T.value,familyMembers:S.value,items:A.value,category:N.value};await U(a),j.back()},q=a=>{S.value=a};return de(()=>{const a=new Date,e=String(a.getDate()).padStart(2,"0"),t=String(a.getMonth()+1).padStart(2,"0"),n=a.getFullYear();m.value=`${n}-${t}-${e}`}),(a,e)=>{const t=ve,n=ge,u=he,x=we,c=xe,g=Ee,J=ye,X=Ne,ee=Ce,te=Le,ae=Ve,ne=be,oe=me;return V(),P(oe,null,{default:i(()=>[l(x,{style:{background:"var(--ion-color-light)"}},{default:i(()=>[l(u,null,{default:i(()=>[l(n,{slot:"end"},{default:i(()=>[l(t,{strong:!0,onClick:e[0]||(e[0]=s=>W())},{default:i(()=>[k("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),l(ne,null,{default:i(()=>[I("div",Me,[l(ae,{lines:"none"},{default:i(()=>[l(c,{type:"file",onChange:O}),l(c,{label:"Nazwa sklepu",modelValue:d(p),"onUpdate:modelValue":e[1]||(e[1]=s=>y(p)?p.value=s:null),error:d(r).shopName},null,8,["modelValue","error"]),l(c,{label:"Nawa wydatku",modelValue:d(L),"onUpdate:modelValue":e[2]||(e[2]=s=>y(L)?L.value=s:null)},null,8,["modelValue"]),l(c,{label:"CaÅ‚kowita kwota",type:"number",error:d(r).newExpenseValue,modelValue:d(f),"onUpdate:modelValue":e[3]||(e[3]=s=>y(f)?f.value=s:null)},null,8,["error","modelValue"]),l(c,{label:"Data",type:"date",error:d(r).newExpenseDate,modelValue:d(m),"onUpdate:modelValue":e[4]||(e[4]=s=>y(m)?m.value=s:null)},null,8,["error","modelValue"]),l(X,null,{default:i(()=>[l(J,{label:"Kategoria","label-placement":"stacked",modelValue:d(N),"onUpdate:modelValue":e[5]||(e[5]=s=>y(N)?N.value=s:null)},{default:i(()=>[(V(!0),M(fe,null,pe(d(z),(s,le)=>(V(),P(g,{key:le,value:s},{default:i(()=>[k(Ie(s),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ee,{onToggleMember:q}),I("div",null,[I("canvas",{ref_key:"canvas",ref:_,style:{display:"none"}},null,512),d(b)?(V(),M("div",Re,[l(te,{name:"lines-sharp"})])):_e("",!0)])]),_:1})])]),_:1})]),_:1})}}},Ae=se(Fe,[["__scopeId","data-v-d4f32078"]]);export{Ae as default};
