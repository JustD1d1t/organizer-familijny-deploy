import{L as ne,M as se,r,o as ue,N as i,O as re,t as u,A as n,z as s,P as t,B as _,Q as p,v as f,R as S,S as C,x as N,T as de,U as ie,V as ce,W as me,X as pe,Y as ve,Z as _e,$ as fe,a0 as be,a1 as ye,y as we,a2 as ge,a3 as Ie,a4 as ke,a5 as he}from"./B4ggqkCG.js";import{_ as Ve}from"./PzQkjnDX.js";import{u as xe}from"./Dp3SNSze.js";const Pe={key:0,class:"inner-content"},Se={class:"modal-content"},Ne={__name:"index",setup(Ce){const{photos:b,photoFromCamera:B,selectPhotoFromData:z}=xe(),M=ne(),{removeExpenseFromStore:T,editExpense:U,getExpensePhoto:F}=M,{currentExpense:e}=se(M),{billCategories:$}=ge(),{openAlert:A}=Ie(),D=re(),d=localStorage.getItem("uid");r("");const I=r(!1),k=r(null),h=r(null),R=r(!1),V=r(e.value.shop),x=r(e.value.name),P=r(e.value.value),y=r(e.value.timestamp),v=r(e.value.familyMembers),Z=()=>{let o;e.value.timestamp.seconds?o=new Date(e.value.timestamp.seconds*1e3):o=new Date(e.value.timestamp);const a=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),w=String(o.getDate()).padStart(2,"0");y.value=`${a}-${c}-${w}`},j=()=>{I.value=!1},L=async()=>{try{const{pb64:o,doc:a}=await B();h.value=o,k.value=a,R.value=!0}catch(o){console.error("Error adding photo",o)}},O=async()=>{try{const{pb64:o,doc:a}=await z();h.value=o,k.value=a}catch(o){console.error("Error selecting photo",o)}},W=async()=>{const o={name:x.value,value:Number(P.value),timestamp:new Date(y.value).getTime(),shop:V.value,familyMembers:v.value,userId:e.value.userId,id:e.value.id,category:e.value.category};await U(o,k.value,h.value),D.back()},Y=async()=>{await T(e.value.id),D.back()},G=async()=>{const o=await F(e.value.id);o&&b.value.push({webviewPath:o,document:{title:"New Photo",description:"Photo taken with the app",timestamp:new Date}})},H=async()=>{I.value=!0};ue(async()=>{await G(),Z()});const K=o=>{v.value.includes(o.id)?v.value=v.value.filter(a=>a!=o.id):v.value.push(o.id)};return(o,a)=>{const c=de,w=ie,Q=ce,X=me,g=pe,m=ve,q=ke,J=_e,ee=Ve,E=he,te=fe,ae=be,oe=ye;return u(),i(oe,null,{default:n(()=>[s(X,{style:{background:"var(--ion-color-light)"}},{default:n(()=>[s(Q,null,{default:n(()=>[t(e)&&t(e).userId===t(d)?(u(),i(w,{key:0,slot:"start"},{default:n(()=>[s(c,{fill:"clear",strong:!0,onClick:a[0]||(a[0]=()=>t(A)("Usuwanie wydatku","Czy na pewno chcesz usunąć wydatek?","alert-button-confirm",Y))},{default:n(()=>[_("Usuń")]),_:1})]),_:1})):p("",!0),t(e)&&t(e).userId===t(d)?(u(),i(w,{key:1,slot:"end"},{default:n(()=>[s(c,{fill:"clear",strong:!0,onClick:a[1]||(a[1]=l=>W())},{default:n(()=>[_("Zapisz")]),_:1})]),_:1})):p("",!0)]),_:1})]),_:1}),s(ae,{fullscreen:!0},{default:n(()=>[t(e)?(u(),f("div",Pe,[s(m,null,{default:n(()=>[s(g,{"data-test":"shop-input",label:"Nazwa sklepu","label-placement":"floating",type:"text",modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=l=>V.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(g,{"data-test":"name-input",label:"Nazwa wydatku","label-placement":"floating",type:"text",modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=l=>x.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(g,{"data-test":"value-input",label:"Całkowita kwota","label-placement":"floating",type:"number",modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=l=>P.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(g,{"data-test":"date-input",label:"Data","label-placement":"floating",type:"date",modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=l=>y.value=l),disabled:t(e).userId!==t(d)},null,8,["modelValue","disabled"])]),_:1}),s(m,null,{default:n(()=>[s(J,{label:"Kategoria",modelValue:t(e).category,"onUpdate:modelValue":a[6]||(a[6]=l=>t(e).category=l)},{default:n(()=>[(u(!0),f(S,null,C(t($),(l,le)=>(u(),i(q,{key:le,value:l},{default:n(()=>[_(we(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(e).userId===t(d)?(u(),i(ee,{key:0,members:t(e).familyMembers,onToggleMember:K},null,8,["members"])):p("",!0),t(e).userId===t(d)?(u(),i(m,{key:1},{default:n(()=>[s(c,{onClick:L},{default:n(()=>[_("Zrób zdjęcie")]),_:1}),s(c,{onClick:O,class:"ml-auto"},{default:n(()=>[_("Wybierz zdjęcie")]),_:1})]),_:1})):p("",!0),t(b).length?(u(),f("div",{key:2,onClick:H},[(u(!0),f(S,null,C(t(b),l=>(u(),i(E,{key:l.webviewPath,src:l.webviewPath},null,8,["src"]))),128))])):p("",!0),s(te,{class:"auto-height modal-img","is-open":I.value,onDidDismiss:a[7]||(a[7]=l=>j())},{default:n(()=>[N("div",Se,[N("div",null,[(u(!0),f(S,null,C(t(b),l=>(u(),i(E,{key:l.webviewPath,src:l.webviewPath},null,8,["src"]))),128))])])]),_:1},8,["is-open"])])):p("",!0)]),_:1})]),_:1})}}};export{Ne as default};
