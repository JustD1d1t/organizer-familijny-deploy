import{ao as W,ap as X,M,r as x,t as c,v as A,z as a,A as o,B as N,P as i,ah as pe,x as B,T as Y,U as ge,V as G,W as J,aq as ye,Y as Ie,X as he,ae as K,ar as be,as as ve,at as we,au as ke,L as Me,i as Se,N as _,a1 as ze,Q as p,S as Ce,R as Fe,l as $e,a6 as Ee,a9 as Le,$ as Te,af as De,av as Ae,ag as Ne,a0 as Be,y as H}from"./B4ggqkCG.js";import{_ as Pe}from"./Dl8-h6Oi.js";import{t as Q,e as Ve,d as Ue,p as Re}from"./CHVAF33P.js";const je={class:"ion-padding inner-content"},Oe=B("h3",null,"Dodaj członka rodziny",-1),Ze={__name:"edit-modal",emits:"cancel",setup(ee,{emit:P}){const V=W(),{sendNotification:g}=V,{backendUrl:S}=be(),{request:U}=ve(),z=X(),{updateMembers:R,createFamily:y}=z,{familyMembersDetails:d}=M(z),C=P,u=x(""),F=x(),I=localStorage.getItem("uid"),j=async f=>{const s=[...d.value,{...f,status:"pending"}];return await R(s),s},$=async f=>{const s=[{email:localStorage.getItem("email"),id:localStorage.getItem("uid"),uid:localStorage.getItem("uid"),nickname:localStorage.getItem("nickname"),status:"accepted"},{...f,status:"pending"}];return await y(s),s},E=async()=>{const s=(await U(`${S}/users/get-users?email=${u.value.toLowerCase()}`)).users;if(!s.length)return;const r=s[0];let l;d.value.length?l=await j(r):l=await $(r),await g({title:`Zaproszenie do rodziny użytkownika "${localStorage.getItem("email")}"`,content:`Zostałeś zaproszony do rodziny przez użytkownika "${localStorage.getItem("email")}"`,type:"invitation-to-family",ownerId:I},r.uid),C("confirmModal",l)},h=()=>{C("cancel")};return(f,s)=>{const r=Y,l=ge,O=G,L=J,m=ye,T=Ie,Z=he,q=K;return c(),A("div",je,[a(L,{style:{background:"var(--ion-color-light)"}},{default:o(()=>[a(O,null,{default:o(()=>[a(l,{fill:"clear",slot:"start"},{default:o(()=>[a(r,{onClick:s[0]||(s[0]=v=>h())},{default:o(()=>[N("Anuluj")]),_:1})]),_:1}),a(l,{slot:"end"},{default:o(()=>[a(r,{strong:!0,onClick:s[1]||(s[1]=v=>E())},{default:o(()=>[N("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(q,{lines:"none"},{default:o(()=>[a(T,null,{default:o(()=>[a(m,null,{default:o(()=>[Oe]),_:1})]),_:1}),a(T,null,{default:o(()=>[a(Z,{"data-test":"shop-input",label:"Mail","label-placement":"floating",ref_key:"emailInput",ref:F,class:"shopInput",type:"text",modelValue:i(u),"onUpdate:modelValue":s[2]||(s[2]=v=>pe(u)?u.value=v:null)},null,8,["modelValue"])]),_:1})]),_:1})])}}},qe=B("h2",null,"Członkowie rodziny",-1),xe={key:0},He={key:0},Ye={__name:"index",setup(ee){const P=W(),{sendNotification:V}=P,g=localStorage.getItem("uid"),S=X(),{updateMembers:U,removeFamily:z,leaveFamily:R}=S,{familyMembers:y,familyMembersDetails:d,familyId:C}=M(S),u=x(),F=we(),{shoppingLists:I}=M(F),{getAllShoppingLists:j,updateShoppingList:$}=F,E=ke(),{pantries:h}=M(E),{getAllPantries:f,editPantry:s}=E,r=Me(),{expenses:l}=M(r),{getAllMyExpenses:O,editExpense:L}=r,m=Se(()=>C.value===g),T=()=>u.value.$el.dismiss(null,"cancel"),Z=()=>u.value.$el.dismiss(null,"confirm"),q=n=>{Z(),d.value=n,m.value=!0},v=async n=>{I.value.length?I.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await $(e))}):(await j(),I.value.length&&I.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await $(e))}))},ne=async n=>{h.value.length?h.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await s(e))}):(await f(),h.value.length&&h.value.forEach(async e=>{e.membersIds.includes(n.id)&&(e.membersIds=e.membersIds.filter(t=>t!==n.id),e.members=e.members.filter(t=>t.id!==n.id),await s(e))}))},te=async n=>{l.value.length?l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(t=>t!==n.id),L(e))}):(await O(),l.value.length&&l.value.forEach(async e=>{e.familyMembers.includes(n.id)&&(e.familyMembers=e.familyMembers.filter(t=>t!==n.id),L(e))}))},oe=async n=>{const e=d.value.filter(w=>w.id!==n.id),t=y.value.filter(w=>w!==n.id);await U(e,t),await v(n),await ne(n),await te(n),await V({title:`Zostałeś usunięty z rodziny "${localStorage.getItem("email")}"`,content:`Zostałeś usunięty z rodziny przez użytkownika "${localStorage.getItem("email")}`},n.id)},ae=async()=>{const n=d.value.filter(t=>t.id!==g),e=y.value.filter(t=>t!==g);await R(n,e),$e("/")};return(n,e)=>{const t=Ee,w=G,se=J,k=Le,ie=Y,le=Pe,ce=K,re=Ze,de=Te,D=De,ue=Ae,me=Ne,fe=Be,_e=ze;return c(),_(_e,null,{default:o(()=>[a(se,{style:{background:"var(--ion-color-light)"}},{default:o(()=>[a(w,null,{default:o(()=>[a(t,null,{default:o(()=>[N("Rodzina")]),_:1})]),_:1})]),_:1}),a(fe,{fullscreen:!0},{default:o(()=>[B("div",null,[qe,i(d).length?p("",!0):(c(),A("h3",xe," Nie należysz do żadnej rodziny ")),a(ce,{lines:"none"},{default:o(()=>[(c(!0),A(Fe,null,Ce(i(d),b=>(c(),_(le,{key:b.id,class:"flex items-center"},{start:o(()=>[B("span",null,[N(H(b.nickname)+" ("+H(b.email)+") ",1),b.status==="pending"?(c(),A("small",He,"(oczekiwanie)")):p("",!0)])]),end:o(()=>[i(m)&&b.id!==i(g)?(c(),_(ie,{key:0,onClick:()=>oe(b),size:"small"},{default:o(()=>[a(k,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024))),128))]),_:1})]),i(m)||!i(y).length?(c(),_(de,{key:0,class:"auto-height",ref_key:"modal",ref:u,trigger:"open-modal"},{default:o(()=>[a(re,{onCancel:T,onConfirmModal:q})]),_:1},512)):p("",!0),a(me,{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:o(()=>[a(D,null,{default:o(()=>[a(k,{icon:"ioniconsArrowUpCircle"in n?n.ioniconsArrowUpCircle:i(Ve)},null,8,["icon"])]),_:1}),a(ue,{side:"top"},{default:o(()=>[i(m)||!i(y).length?(c(),_(D,{key:0,id:"open-modal"},{default:o(()=>[a(k,{icon:"ioniconsAdd"in n?n.ioniconsAdd:i(Ue)},null,8,["icon"])]),_:1})):p("",!0),i(m)?p("",!0):(c(),_(D,{key:1,onClick:ae},{default:o(()=>[a(k,{icon:"ioniconsPlayForwardCircleOutline"in n?n.ioniconsPlayForwardCircleOutline:i(Re)},null,8,["icon"])]),_:1})),i(m)?(c(),_(D,{key:2,onClick:i(z)},{default:o(()=>[a(k,{icon:"ioniconsTrash"in n?n.ioniconsTrash:i(Q)},null,8,["icon"])]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ye as default};
