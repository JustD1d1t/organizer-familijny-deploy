import{_ as Ve,M as ye,ac as be,L as he,u as ke,r,N as E,A as l,Z as xe,t as v,z as a,B as m,x as R,O as n,a2 as I,v as P,Q as F,R as T,P as Ne,ah as Ie,U as Le,V as Ce,W as Ee,a4 as Pe,a6 as Se,a1 as Ue,ao as De,ag as Me,S as ze,Y as Re,a7 as Fe,y as B,a3 as Te,aa as Be}from"./CSz8cOni.js";import{_ as Oe}from"./4MMZrP91.js";import{_ as je}from"./CoaZJDH_.js";import{T as Ae,u as Ke}from"./D7uZvskA.js";import{u as We}from"./B4tFuksg.js";const Ze={class:"inner-content"},$e={key:0,class:"w-full mt-8 flex justify-center items-center h-full"},Ge={__name:"index",setup(He){const{popularStores:q}=Ke();We();const J=ye(),{addExpenseToStore:X}=J,ee=be(),{uid:ae}=he(ee),{billCategories:S}=Te(),le=ke(),L=r(""),C=r(""),g=r(""),w=r(""),f=r(""),O=r([]);r(null),r(null),r(!1);const j=r(!1),U=r(!1),c=r({newShopName:"",newExpenseName:"",newExpenseValue:"",newExpenseDate:""}),b=r(null),A=r(!1),K=r(!1),p=r({name:"",price:"",category:""}),W=r(null),Z=r([]),V=r(null);let k=null,x=null,h=0;const te=async s=>{j.value=!1,U.value=!0,W.value=null,k=null,x=null,h=0,f.value="",g.value="",w.value="";const e=s.target.files[0];if(!e)return;const o=new Image,u=new FileReader;u.onload=i=>{o.src=i.target.result},o.onload=()=>oe(o),u.readAsDataURL(e)},oe=s=>{const e=V.value.getContext("2d");V.value.width=s.width,V.value.height=s.height,e.drawImage(s,0,0),ne(e),se()},ne=s=>{const e=s.getImageData(0,0,V.value.width,V.value.height),o=e.data;for(let u=0;u<o.length;u+=4){const i=(o[u]+o[u+1]+o[u+2])/3;o[u]=o[u+1]=o[u+2]=i}s.putImageData(e,0,0)},se=()=>{V.value.toBlob(s=>{Ae.recognize(s,"pol").then(({data:{text:e}})=>{W.value=e,re(e)}).catch(e=>console.error("OCR processing error:",e))})},ue=s=>{for(let e of q){const o=e.length*.5,u=e.toLowerCase(),i=s.toLowerCase();if(i.includes(u)&&u.split("").filter(d=>i.includes(d)).length>=o)return e}return null},re=s=>{s.split(`
`).forEach(o=>{if(!f.value){const _=ue(o);f.value=_}const u=o.match(/\d{1,4},\d{2}/),i=o.match(/SUMA\sPLN/),y=o.match(/RAZEM\sPLN/),d=o.match(/\d{4}\s*-\s*\d{2}\s*-\s*\d{2}/);if(i&&$(i,"sumaPLN"),y&&$(y,"razemPLN"),d&&(w.value=d[0].replaceAll(" ","")),u){const _=parseFloat(u[0].replace(",","."));_>h&&(h=_)}}),g.value=de(),j.value=!0,U.value=!1},$=(s,e)=>{const o=s.input.match(/\d{1,4},\d{2}/);if(o){const u=parseFloat(o[0].replace(",","."));e==="sumaPLN"&&(k=u),e==="razemPLN"&&(x=u)}},de=()=>k&&k===h?k:x&&x===h?x:h,ie=()=>{c.value.shopName="",c.value.newExpenseValue="",c.value.newExpenseDate="",c.value.selectedCategory="",f.value||(c.value.shopName="Nazwa sklepu jest wymagana"),g.value||(c.value.newExpenseValue="Kwota jest wymagana"),w.value||(c.value.newExpenseDate="Data jest wymagana")},ce=async()=>{if(ie(),Object.values(c.value).some(e=>e))return;const s={name:C.value.toLowerCase(),value:parseFloat(g.value),timestamp:new Date(w.value).getTime(),shop:f.value.toLowerCase(),userId:ae.value,familyMembers:O.value,items:Z.value,category:L.value};await X(s),le.back()},pe=s=>{O.value=s},G=s=>A.value=s,me=s=>K.value=s,fe=()=>{Z.value.push({name:p.value.name,price:parseFloat(p.value.price),category:p.value.category}),me(!1),p.value={name:"",price:"",category:""}};return(s,e)=>{const o=Ie,u=Le,i=Ce,y=Ee,d=Pe,_=Be,D=Se,M=Ue,_e=Oe,ve=De,ge=Me,H=ze,Q=je,z=Re,Y=Fe,we=xe;return v(),E(we,null,{default:l(()=>[a(y,{style:{background:"var(--ion-color-light)"}},{default:l(()=>[a(i,null,{default:l(()=>[a(u,{slot:"end"},{default:l(()=>[a(o,{strong:!0,onClick:e[0]||(e[0]=t=>ce())},{default:l(()=>[m("Dodaj")]),_:1})]),_:1})]),_:1})]),_:1}),a(z,null,{default:l(()=>[R("div",Ze,[a(ge,{lines:"none"},{default:l(()=>[a(d,{type:"file",onChange:te}),a(d,{label:"Nazwa sklepu",modelValue:n(f),"onUpdate:modelValue":e[1]||(e[1]=t=>I(f)?f.value=t:null),error:n(c).shopName},null,8,["modelValue","error"]),a(d,{label:"Nawa wydatku",modelValue:n(C),"onUpdate:modelValue":e[2]||(e[2]=t=>I(C)?C.value=t:null)},null,8,["modelValue"]),a(d,{label:"Całkowita kwota",type:"number",error:n(c).newExpenseValue,modelValue:n(g),"onUpdate:modelValue":e[3]||(e[3]=t=>I(g)?g.value=t:null)},null,8,["error","modelValue"]),a(d,{label:"Data",type:"date",error:n(c).newExpenseDate,modelValue:n(w),"onUpdate:modelValue":e[4]||(e[4]=t=>I(w)?w.value=t:null)},null,8,["error","modelValue"]),a(M,null,{default:l(()=>[a(D,{label:"Kategoria","label-placement":"stacked",modelValue:n(L),"onUpdate:modelValue":e[5]||(e[5]=t=>I(L)?L.value=t:null)},{default:l(()=>[(v(!0),P(T,null,F(n(S),(t,N)=>(v(),E(_,{key:N,value:t},{default:l(()=>[m(B(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(_e,{onToggleMember:pe}),R("div",null,[R("canvas",{ref_key:"canvas",ref:V,style:{display:"none"}},null,512),n(U)?(v(),P("div",$e,[a(ve,{name:"lines-sharp"})])):Ne("",!0)])]),_:1})]),a(Y,{"is-open":n(A)},{default:l(()=>[a(y,null,{default:l(()=>[a(i,null,{default:l(()=>[a(H,null,{default:l(()=>[m("Edytuj produkt")]),_:1}),a(u,{slot:"end"},{default:l(()=>[a(o,{onClick:e[6]||(e[6]=t=>G(!1))},{default:l(()=>[m("Close")]),_:1})]),_:1})]),_:1})]),_:1}),a(z,{class:"ion-padding"},{default:l(()=>[a(Q,null,{default:l(()=>[a(d,{modelValue:n(b).name,"onUpdate:modelValue":e[7]||(e[7]=t=>n(b).name=t),label:"Nazwa produktu"},null,8,["modelValue"]),a(d,{modelValue:n(b).price,"onUpdate:modelValue":e[8]||(e[8]=t=>n(b).price=t),label:"Cena produktu"},null,8,["modelValue"]),a(M,null,{default:l(()=>[a(D,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:n(b).category,"onUpdate:modelValue":e[9]||(e[9]=t=>n(b).category=t)},{default:l(()=>[(v(!0),P(T,null,F(n(S),(t,N)=>(v(),E(_,{key:N,value:t},{default:l(()=>[m(B(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]),a(Y,{"is-open":n(K)},{default:l(()=>[a(y,null,{default:l(()=>[a(i,null,{default:l(()=>[a(u,{slot:"start"},{default:l(()=>[a(o,{onClick:e[10]||(e[10]=t=>G(!1))},{default:l(()=>[m("anuluj")]),_:1})]),_:1}),a(H,null,{default:l(()=>[m("Nowy produkt")]),_:1}),a(u,{slot:"end"},{default:l(()=>[a(o,{onClick:fe},{default:l(()=>[m("Zapisz")]),_:1})]),_:1})]),_:1})]),_:1}),a(z,{class:"ion-padding"},{default:l(()=>[a(Q,null,{default:l(()=>[a(d,{modelValue:n(p).name,"onUpdate:modelValue":e[11]||(e[11]=t=>n(p).name=t),label:"Nazwa produktu"},null,8,["modelValue"]),a(d,{modelValue:n(p).price,"onUpdate:modelValue":e[12]||(e[12]=t=>n(p).price=t),label:"Cena produktu"},null,8,["modelValue"]),a(M,null,{default:l(()=>[a(D,{label:"Kategoria","label-placement":"stacked",placeholder:"--- Wybierz kategorię ---",modelValue:n(p).category,"onUpdate:modelValue":e[13]||(e[13]=t=>n(p).category=t)},{default:l(()=>[(v(!0),P(T,null,F(n(S),(t,N)=>(v(),E(_,{key:N,value:t},{default:l(()=>[m(B(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1})}}},ea=Ve(Ge,[["__scopeId","data-v-3c112e2e"]]);export{ea as default};
